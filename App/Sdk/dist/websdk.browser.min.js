!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebIM=t():e.WebIM=t()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(module,exports,__webpack_require__){function _parsePrivacy(e){var t=[],n=e.getElementsByTagName("item");if(n)for(var o=0;o<n.length;o++){var i=n[o],r=i.getAttribute("value"),s=i.getAttribute("order"),a=i.getAttribute("type");if(r){var c=_parseNameFromJidFn(r);t[c]={type:a,order:s,jid:r,name:c}}}return t}function _parseGroupBlacklist(e){var t={},n=e.getElementsByTagName("item");if(n)for(var o=0;o<n.length;o++){var i=n[o],r=i.getAttribute("jid"),s=i.getAttribute("affiliation"),a=i.getAttribute("nick");if(r){var c=_parseNameFromJidFn(r);t[c]={jid:r,affiliation:s,nick:a,name:c}}}return t}function _setText(e,t){"textContent"in e?e.textContent=t:"text"in e&&(e.text=t)}__webpack_require__(2);var _version="1.1.3",_code=__webpack_require__(3).code,_utils=__webpack_require__(4).utils,_msg=__webpack_require__(5),_message=_msg._msg,_msgHash={},Queue=__webpack_require__(6).Queue,PAGELIMIT=2,pageLimitKey=(new Date).getTime();window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,window.XDomainRequest&&(XDomainRequest.prototype.oldsend=XDomainRequest.prototype.send,XDomainRequest.prototype.send=function(){XDomainRequest.prototype.oldsend.apply(this,arguments),this.readyState=2}),Strophe.Request.prototype._newXHR=function(){var e=_utils.xmlrequest(!0);return e.overrideMimeType&&e.overrideMimeType("text/xml"),e.onreadystatechange=this.func.bind(null,this),e},Strophe.Websocket.prototype._closeSocket=function(){if(this.socket){var e=this;setTimeout(function(){try{e.socket.close()}catch(e){}},0)}else this.socket=null},Strophe.Websocket.prototype._onMessage=function(e){WebIM&&WebIM.config.isDebug&&console.log(WebIM.utils.ts()+"recv:",e.data);var t,n;if(0===e.data.indexOf("<close ")){t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement;var o=t.getAttribute("see-other-uri");return void(o?(this._conn._changeConnectStatus(Strophe.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=o,this._connect()):this._conn._doDisconnect("receive <close> from server"))}if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else n=this._streamWrap(e.data),t=(new DOMParser).parseFromString(n,"text/xml").documentElement;if(!this._check_streamerror(t,Strophe.Status.ERROR))return this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Strophe.serialize(t))):void this._conn._dataRecv(t,e.data)};var _listenNetwork=function(e,t){window.addEventListener?(window.addEventListener("online",e),window.addEventListener("offline",t)):window.attachEvent&&(document.body?(document.body.attachEvent("ononline",e),document.body.attachEvent("onoffline",t)):window.attachEvent("load",function(){document.body.attachEvent("ononline",e),document.body.attachEvent("onoffline",t)}))},_parseRoom=function(e){var t=[],n=e.getElementsByTagName("item");if(n)for(var o=0;o<n.length;o++){var i=n[o],r=i.getAttribute("jid"),s=r.split("@")[0],a={jid:r,name:i.getAttribute("name"),roomId:s.split("_")[1]};t.push(a)}return t},_parseRoomOccupants=function(e){var t=[],n=e.getElementsByTagName("item");if(n)for(var o=0;o<n.length;o++){var i=n[o],r={jid:i.getAttribute("jid"),name:i.getAttribute("name")};t.push(r)}return t},_parseResponseMessage=function(msginfo){var parseMsgData={errorMsg:!0,data:[]},msgBodies=msginfo.getElementsByTagName("body");if(msgBodies){for(var i=0;i<msgBodies.length;i++){var msgBody=msgBodies[i],childNodes=msgBody.childNodes;if(childNodes&&childNodes.length>0){var childNode=msgBody.childNodes[0];if(childNode.nodeType==Strophe.ElementType.TEXT){var jsondata=childNode.wholeText||childNode.nodeValue;jsondata=jsondata.replace("\n","<br>");try{var data=eval("("+jsondata+")");parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(e){}}}}var delayTags=msginfo.getElementsByTagName("delay");if(delayTags&&delayTags.length>0){var delayTag=delayTags[0],delayMsgTime=delayTag.getAttribute("stamp");delayMsgTime&&(parseMsgData.delayTimeStamp=delayMsgTime)}}else{var childrens=msginfo.childNodes;if(childrens&&childrens.length>0){var child=msginfo.childNodes[0];if(child.nodeType==Strophe.ElementType.TEXT)try{var data=eval("("+child.nodeValue+")");parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(e){}}}return parseMsgData},_parseNameFromJidFn=function(e,t){t=t||"";var n=e,o=n.indexOf("_");o!==-1&&(n=n.substring(o+1));var i=n.indexOf("@"+t);return i!==-1&&(n=n.substring(0,i)),n},_parseFriend=function(e,t,n){var o=[],i=e.getElementsByTagName("item");if(i)for(var r=0;r<i.length;r++){var s=i[r],a=s.getAttribute("jid");if(a){var c=s.getAttribute("subscription"),u={subscription:c,jid:a},l=s.getAttribute("ask");l&&(u.ask=l);var d=s.getAttribute("name");if(d)u.name=d;else{var h=_parseNameFromJidFn(a);u.name=h}var p=[];Strophe.forEachChild(s,"group",function(e){p.push(Strophe.getText(e))}),u.groups=p,o.push(u),t&&"from"==c&&t.subscribe({toJid:a}),t&&"to"==c&&t.subscribed({toJid:a})}}return o},_login=function(e,t){var n=e.access_token||"";if(""==n){_utils.stringify(e);return void t.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:e})}t.context.accessToken=e.access_token,t.context.accessTokenExpires=e.expires_in;var o=null;o=t.isOpening()&&t.context.stropheConn?t.context.stropheConn:t.isOpened()&&t.context.stropheConn?new Strophe.Connection(t.url,{inactivity:t.inactivity,maxRetries:t.maxRetries,pollingTime:t.pollingTime}):new Strophe.Connection(t.url,{inactivity:t.inactivity,maxRetries:t.maxRetries,pollingTime:t.pollingTime});var i=function(e,n){_loginCallback(e,n,t)};t.context.stropheConn=o,t.route?o.connect(t.context.jid,"$t$"+n,i,t.wait,t.hold,t.route):o.connect(t.context.jid,"$t$"+n,i,t.wait,t.hold)},_parseMessageType=function(e){var t="normal",n=e.getElementsByTagName("received");if(n&&n.length>0&&"urn:xmpp:receipts"===n[0].namespaceURI)t="received";else{var o=e.getElementsByTagName("invite");o&&o.length>0&&(t="invite")}return t},_handleMessageQueue=function(e){for(var t in _msgHash)_msgHash.hasOwnProperty(t)&&_msgHash[t].send(e)},_loginCallback=function(e,t,n){var o,i;if("conflict"===t&&(o=!0),e==Strophe.Status.CONNFAIL)i={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:t,reconnect:!0},o&&(i.conflict=!0),n.onError(i);else if(e==Strophe.Status.ATTACHED||e==Strophe.Status.CONNECTED){n.intervalId=setInterval(function(){n.handelSendQueue()},200);var r=function(e){var t=_parseMessageType(e);return"received"===t?(n.handleReceivedMessage(e),!0):"invite"===t?(n.handleInviteMessage(e),!0):(n.handleMessage(e),!0)},s=function(e){return n.handlePresence(e),!0},a=function(e){return n.handlePing(e),!0},c=function(e){return n.handleIqRoster(e),!0},u=function(e){return n.handleIqPrivacy(e),!0},l=function(e){return n.handleIq(e),!0};n.addHandler(r,null,"message",null,null,null),n.addHandler(s,null,"presence",null,null,null),n.addHandler(a,"urn:xmpp:ping","iq","get",null,null),n.addHandler(c,"jabber:iq:roster","iq","set",null,null),n.addHandler(u,"jabber:iq:privacy","iq","set",null,null),n.addHandler(l,null,"iq",null,null,null),n.context.status=_code.STATUS_OPENED;var d=[_code.WEBIM_MESSAGE_REC_TEXT,_code.WEBIM_MESSAGE_REC_EMOJI];_utils.isCanDownLoadFile&&(d.push(_code.WEBIM_MESSAGE_REC_PHOTO),d.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE));var h=[_code.WEBIM_MESSAGE_SED_TEXT];_utils.isCanUploadFile&&(h.push(_code.WEBIM_MESSAGE_REC_PHOTO),h.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE)),n.notifyVersion(),n.retry&&_handleMessageQueue(n),n.heartBeat(),n.isAutoLogin&&n.setPresence(),n.onOpened({canReceive:d,canSend:h,accessToken:n.context.accessToken})}else if(e==Strophe.Status.DISCONNECTING)n.isOpened()&&(n.stopHeartBeat(),n.context.status=_code.STATUS_CLOSING,i={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:t,reconnect:!0},o&&(i.conflict=!0),n.onError(i));else if(e==Strophe.Status.DISCONNECTED){if(n.isOpened()){if(Demo.conn.autoReconnectNumTotal<Demo.conn.autoReconnectNumMax)return void Demo.conn.reconnect();i={type:_code.WEBIM_CONNCTION_DISCONNECTED},n.onError(i)}n.context.status=_code.STATUS_CLOSED,n.clear(),n.onClosed()}else e==Strophe.Status.AUTHFAIL?(i={type:_code.WEBIM_CONNCTION_AUTH_ERROR},o&&(i.conflict=!0),n.onError(i),n.clear()):e==Strophe.Status.ERROR&&(n.context.status=_code.STATUS_ERROR,i={type:_code.WEBIM_CONNCTION_SERVER_ERROR},o&&(i.conflict=!0),n.onError(i));n.context.status_now=e},_getJid=function(e,t){var n=e.toJid||"";if(""===n){var o=t.context.appKey||"",i=o+"_"+e.to+"@"+t.domain;e.resource&&(i=i+"/"+e.resource),n=i}return n},_getJidByName=function(e,t){var n={to:e};return _getJid(n,t)},_validCheck=function(e,t){if(e=e||{},""==e.user)return t.onError({type:_code.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR}),!1;var n=e.user+""||"",o=e.appKey||"",i=o.split("#");if(2!==i.length)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var r=i[0],s=i[1];if(!r)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;if(!s)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var a=o+"_"+n.toLowerCase()+"@"+t.domain,c=e.resource||"webim";return t.isMultiLoginSessions&&(c+=n+(new Date).getTime()+Math.floor(1e6*Math.random().toFixed(6))),t.context.jid=a+"/"+c,t.context.userId=n,t.context.appKey=o,t.context.appName=s,t.context.orgName=r,!0},_getXmppUrl=function(e,t){if(/^(ws|http)s?:\/\/?/.test(e))return e;var n={prefix:"http",base:"://"+e,suffix:"/http-bind/"};return t&&_utils.isSupportWss?(n.prefix="wss",n.suffix="/ws/"):t?n.prefix="https":window.WebSocket&&(n.prefix="ws",n.suffix="/ws/"),n.prefix+n.base+n.suffix},_handlePageLimit=function(){if(WebIM.config.isMultiLoginSessions&&window.localStorage){var e="empagecount"+pageLimitKey;window.addEventListener("storage",function(){window.localStorage.setItem(e,Demo.user)}),_clearPageSign(),window.localStorage.setItem(e,Demo.user)}},_clearPageSign=function(){if(window.localStorage)try{window.localStorage.clear()}catch(e){}},_getPageCount=function(){var e=0;if(WebIM.config.isMultiLoginSessions&&window.localStorage)for(var t in localStorage)/^empagecount/.test(t)&&Demo.user==localStorage[t]&&e++;return console.log(e),e},connection=function(e){if(!this instanceof connection)return new connection(e);var e=e||{};this.isMultiLoginSessions=e.isMultiLoginSessions||!1,this.wait=e.wait||30,this.retry=e.retry||!1,this.https=e.https||"https:"===location.protocol,this.url=_getXmppUrl(e.url,this.https),this.hold=e.hold||1,this.route=e.route||null,this.domain=e.domain||"hyphenate.io",this.inactivity=e.inactivity||30,this.heartBeatWait=e.heartBeatWait||4500,this.maxRetries=e.maxRetries||5,this.isAutoLogin=e.isAutoLogin!==!1,this.pollingTime=e.pollingTime||800,this.stropheConn=!1,this.autoReconnectNumMax=e.autoReconnectNumMax||0,this.autoReconnectNumTotal=0,this.autoReconnectInterval=e.autoReconnectInterval||0,this.context={status:_code.STATUS_INIT},this.sendQueue=new Queue,this.intervalId=null};connection.prototype.handelSendQueue=function(){var e=this.sendQueue.pop();null!==e&&this.sendReceiptsMessage(e)},connection.prototype.listen=function(e){e.url&&(this.url=_getXmppUrl(e.url,this.https)),this.onOpened=e.onOpened||_utils.emptyfn,this.onClosed=e.onClosed||_utils.emptyfn,this.onTextMessage=e.onTextMessage||_utils.emptyfn,this.onEmojiMessage=e.onEmojiMessage||_utils.emptyfn,this.onPictureMessage=e.onPictureMessage||_utils.emptyfn,this.onAudioMessage=e.onAudioMessage||_utils.emptyfn,this.onVideoMessage=e.onVideoMessage||_utils.emptyfn,this.onFileMessage=e.onFileMessage||_utils.emptyfn,this.onLocationMessage=e.onLocationMessage||_utils.emptyfn,this.onCmdMessage=e.onCmdMessage||_utils.emptyfn,this.onPresence=e.onPresence||_utils.emptyfn,this.onRoster=e.onRoster||_utils.emptyfn,this.onError=e.onError||_utils.emptyfn,this.onReceivedMessage=e.onReceivedMessage||_utils.emptyfn,this.onInviteMessage=e.onInviteMessage||_utils.emptyfn,this.onOffline=e.onOffline||_utils.emptyfn,this.onOnline=e.onOnline||_utils.emptyfn,this.onConfirmPop=e.onConfirmPop||_utils.emptyfn,this.onUpdateMyGroupList=e.onUpdateMyGroupList||_utils.emptyfn,this.onUpdateMyRoster=e.onUpdateMyRoster||_utils.emptyfn,this.onBlacklistUpdate=e.onBlacklistUpdate||_utils.emptyfn,_listenNetwork(this.onOnline,this.onOffline)},connection.prototype.heartBeat=function(){var e=this,t=!/^ws|wss/.test(e.url)||/mobile/.test(navigator.userAgent);if(!this.heartBeatID&&t){var n={toJid:this.domain,type:"normal"};this.heartBeatID=setInterval(function(){e.ping(n)},this.heartBeatWait)}},connection.prototype.stopHeartBeat=function(){"number"==typeof this.heartBeatID&&(this.heartBeatID=clearInterval(this.heartBeatID))},connection.prototype.sendReceiptsMessage=function(e){var t=$msg({from:this.context.jid||"",to:this.domain,id:e.id||""}).c("received",{xmlns:"urn:xmpp:receipts",id:e.id||""});this.sendCommand(t.tree())},connection.prototype.cacheReceiptsMessage=function(e){this.sendQueue.push(e)},connection.prototype.open=function(e){_handlePageLimit(),setTimeout(function(){var e=_getPageCount();e>PAGELIMIT&&(Demo.api.NotifyError(Demo.lan.nomorethan+PAGELIMIT+Demo.lan.reslogatonetime),setTimeout(function(){location.reload()},500))},50);var t=_validCheck(e,this);if(t){var n=this;if(!n.isOpening()&&!n.isOpened())if(e.accessToken)e.access_token=e.accessToken,_login(e,n);else{var o=e.apiUrl,i=this.context.userId,r=e.pwd||"",s=this.context.appName,a=this.context.orgName,c=function(e,t){n.context.status=_code.STATUS_DOLOGIN_IM,n.context.restTokenData=e,_login(e,n)},u=function(e,t,o){n.clear(),e.error&&e.error_description?n.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:e,xhr:t}):n.onError({type:_code.WEBIM_CONNCTION_OPEN_ERROR,data:e,xhr:t})};this.context.status=_code.STATUS_DOLOGIN_USERGRID;var l={grant_type:"password",username:i,password:r,timestamp:+new Date},d=_utils.stringify(l),e={url:o+"/"+a+"/"+s+"/token",dataType:"json",data:d,success:c||_utils.emptyfn,error:u||_utils.emptyfn};_utils.ajax(e)}}},connection.prototype.attach=function(e){var t=_validCheck(e,this);if(t){e=e||{};var n=e.accessToken||"";if(""==n)return void this.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR});var o=e.sid||"";if(""===o)return void this.onError({type:_code.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR});var i=e.rid||"";if(""===i)return void this.onError({type:_code.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR});var r=new Strophe.Connection(this.url,{inactivity:this.inactivity,maxRetries:this.maxRetries,pollingTime:this.pollingTime,heartBeatWait:this.heartBeatWait});this.context.accessToken=n,this.context.stropheConn=r,this.context.status=_code.STATUS_DOLOGIN_IM;var s=this,a=function(e,t){_loginCallback(e,t,s)},c=this.context.jid,u=this.wait,l=this.hold,d=this.wind||5;r.attach(c,o,i,a,u,l,d)}},connection.prototype.close=function(e){this.stopHeartBeat();var t=this.context.status;t!=_code.STATUS_INIT&&(this.isClosed()||this.isClosing()||(this.context.status=_code.STATUS_CLOSING,this.context.stropheConn.disconnect(e)))},connection.prototype.addHandler=function(e,t,n,o,i,r,s){this.context.stropheConn.addHandler(e,t,n,o,i,r,s)},connection.prototype.notifyVersion=function(e,t){var n=(_getJid({},this),$iq({from:this.context.jid||"",to:this.domain,type:"result"}).c("query",{xmlns:"jabber:iq:version"}).c("name").t("hyphenate").up().c("version").t(_version).up().c("os").t("webim")),e=e||_utils.emptyfn,o=t||this.onError,i=function(e){o({type:_code.WEBIM_CONNCTION_NOTIFYVERSION_ERROR,data:e})};this.context.stropheConn.sendIQ(n.tree(),e,i)},connection.prototype.handlePresence=function(e){if(!this.isClosed()){var t=e.getAttribute("from")||"",n=e.getAttribute("to")||"",o=e.getAttribute("type")||"",i=e.getAttribute("presence_type")||"",r=_parseNameFromJidFn(t),s=_parseNameFromJidFn(n),a={from:r,to:s,fromJid:t,toJid:n,type:o,chatroom:!!e.getElementsByTagName("roomtype").length},c=e.getElementsByTagName("show");if(c&&c.length>0){var u=c[0];a.show=Strophe.getText(u)}var l=e.getElementsByTagName("status");if(l&&l.length>0){var d=l[0];a.status=Strophe.getText(d),a.code=d.getAttribute("code")}var h=e.getElementsByTagName("priority");if(h&&h.length>0){var p=h[0];a.priority=Strophe.getText(p)}var _=e.getElementsByTagName("error");if(_&&_.length>0){var _=_[0];a.error={code:_.getAttribute("code")}}var m=e.getElementsByTagName("destroy");if(m&&m.length>0){var m=m[0];a.destroy=!0;var f=m.getElementsByTagName("reason");f&&f.length>0&&(a.reason=Strophe.getText(f[0]))}var g=e.getElementsByTagName("item");if(g&&g.length>0){var y=g[0],v=y.getAttribute("role"),E=y.getAttribute("jid");if("none"==v&&E){var N=_parseNameFromJidFn(E),T=y.getElementsByTagName("actor")[0],O=T.getAttribute("nick");a.actor=O,a.kicked=N}"moderator"==v&&"201"==a.code&&(a.type="joinPublicGroupSuccess")}var S=e.getElementsByTagName("apply");if(S&&S.length>0){S=S[0];var b=S.getAttribute("toNick"),I=S.getAttribute("to"),x=S.getAttribute("from"),R=_parseNameFromJidFn(I);_parseNameFromJidFn(x);a.toNick=b,a.groupName=R,a.type="joinGroupNotifications";var f=S.getElementsByTagName("reason");f&&f.length>0&&(a.reason=Strophe.getText(f[0]))}if(a.chatroom){a.presence_type=i,a.original_type=a.type;var C=t.slice(t.lastIndexOf("/")+1);C===this.context.userId&&(""!==a.type||a.code?"unavailable"!==i&&"unavailable"!==a.type||(a.status?110==a.code?a.type="leaveChatRoom":a.error&&406==a.error.code&&(a.type="reachChatRoomCapacity"):a.type="leaveChatRoom"):a.type="joinChatRoomSuccess")}else a.presence_type=i,a.original_type=o,a.type||(""!=o||a.status||a.error?"unavailable"!==i&&"unavailable"!==o||(a.destroy?a.type="deleteGroupChat":307!=a.code&&321!=a.code||(a.type="leaveGroup")):a.type="joinPublicGroupSuccess");this.onPresence(a,e)}},connection.prototype.handlePing=function(e){if(!this.isClosed()){var t=e.getAttribute("id"),n=e.getAttribute("from"),o=e.getAttribute("to"),i=$iq({from:o,to:n,id:t,type:"result"});this.sendCommand(i.tree())}},connection.prototype.handleIq=function(e){return!0},connection.prototype.handleIqPrivacy=function(e){var t=e.getElementsByTagName("list");0!=t.length&&this.getBlacklist()},connection.prototype.handleIqRoster=function(e){var t=e.getAttribute("id"),n=e.getAttribute("from")||"",o=(_parseNameFromJidFn(n),this.context.jid),i=(this.context.userId,$iq({type:"result",id:t,from:o}));this.sendCommand(i.tree());var r=e.getElementsByTagName("query");if(r&&r.length>0){var s=r[0],a=_parseFriend(s,this,n);this.onRoster(a)}return!0},connection.prototype.handleMessage=function(e){if(!this.isClosed()){var t=e.getAttribute("id")||"";this.cacheReceiptsMessage({id:t});var n=_parseResponseMessage(e);if(n.errorMsg)return void this.handlePresence(e);var o=e.getElementsByTagName("error"),i="",r="",s=!1;if(o.length>0){s=!0,i=o[0].getAttribute("code");var a=o[0].getElementsByTagName("text");r=a[0].textContent||a[0].text,log("handle error",i,r)}var c=n.data;for(var u in c)if(c.hasOwnProperty(u)){var l=c[u];if(l.from&&l.to){var d=(l.from+"").toLowerCase(),h=(l.to+"").toLowerCase(),p=l.ext||{},_="",m=e.getElementsByTagName("roomtype");_=m.length?m[0].getAttribute("type")||"chat":e.getAttribute("type")||"chat";var f=l.bodies;if(f&&0!=f.length){var g=l.bodies[0],y=g.type;try{switch(y){case"txt":var v=g.msg,E=_utils.parseTextMessage(v,WebIM.Emoji);if(E.isemoji){var l={id:t,type:_,from:d,to:h,delay:n.delayTimeStamp,data:E.body,ext:p};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onEmojiMessage(l)}else{var l={id:t,type:_,from:d,to:h,delay:n.delayTimeStamp,data:v,ext:p};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onTextMessage(l)}break;case"img":var N=0,T=0;g.size&&(N=g.size.width,T=g.size.height);var l={id:t,type:_,from:d,to:h,url:g.url,secret:g.secret,filename:g.filename,thumb:g.thumb,thumb_secret:g.thumb_secret,file_length:g.file_length||"",width:N,height:T,filetype:g.filetype||"",accessToken:this.context.accessToken||"",ext:p,delay:n.delayTimeStamp};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onPictureMessage(l);break;case"audio":var l={id:t,type:_,from:d,to:h,url:g.url,secret:g.secret,filename:g.filename,length:g.length||"",file_length:g.file_length||"",filetype:g.filetype||"",accessToken:this.context.accessToken||"",ext:p,delay:n.delayTimeStamp};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onAudioMessage(l);break;case"file":var l={id:t,type:_,from:d,to:h,url:g.url,secret:g.secret,filename:g.filename,file_length:g.file_length,accessToken:this.context.accessToken||"",ext:p,delay:n.delayTimeStamp};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onFileMessage(l);break;case"loc":var l={id:t,type:_,from:d,to:h,addr:g.addr,lat:g.lat,lng:g.lng,ext:p,delay:n.delayTimeStamp};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onLocationMessage(l);break;case"video":var l={id:t,type:_,from:d,to:h,url:g.url,secret:g.secret,filename:g.filename,file_length:g.file_length,accessToken:this.context.accessToken||"",ext:p,delay:n.delayTimeStamp};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onVideoMessage(l);break;case"cmd":var l={id:t,from:d,to:h,action:g.action,ext:p,delay:n.delayTimeStamp};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onCmdMessage(l)}}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}}}}}},connection.prototype.handleReceivedMessage=function(e){try{this.onReceivedMessage(e)}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}var t,n,o=e.getElementsByTagName("received");if(o.length>0&&(t=o[0].childNodes&&o[0].childNodes.length>0?o[0].childNodes[0].nodeValue:o[0].innerHTML||o[0].innerText,n=o[0].getAttribute("mid")),_msgHash[t]){try{_msgHash[t].msg.success instanceof Function&&_msgHash[t].msg.success(t,n)}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}delete _msgHash[t]}},connection.prototype.handleInviteMessage=function(e){var t=null,n=e.getElementsByTagName("invite"),o=e.getElementsByTagName("reason")[0],i=o.textContent,r=e.getAttribute("id")||"";if(this.sendReceiptsMessage({id:r}),n&&n.length>0){var s=n[0].getAttribute("from");t=_parseNameFromJidFn(s)}var a=e.getElementsByTagName("x"),c=null;if(a&&a.length>0)for(var u=0;u<a.length;u++)if("jabber:x:conference"===a[u].namespaceURI){var l=a[u].getAttribute("jid");c=_parseNameFromJidFn(l)}this.onInviteMessage({type:"invite",from:t,roomid:c,reason:i})},connection.prototype.sendCommand=function(e,t){this.isOpened()?this.context.stropheConn.send(e):this.onError({type:_code.WEBIM_CONNCTION_DISCONNECTED,reconnect:!0})},connection.prototype.getUniqueId=function(e){var t=new Date,n=new Date(2010,1,1),o=t.getTime()-n.getTime(),i=parseInt(o).toString(16);return"string"==typeof e||"number"==typeof e?e+"_"+i:"WEBIM_"+i},connection.prototype.send=function(e){if(WebIM.config.isWindowSDK)WebIM.doQuery('{"type":"sendMessage","to":"'+e.to+'","message_type":"'+e.type+'","msg":"'+encodeURI(e.msg)+'","chatType":"'+e.chatType+'"}',function(e){},function(e,t){Demo.api.NotifyError("send:"+e+" - "+t)});else if("[object Object]"===Object.prototype.toString.call(e)){var t=this.context.appKey||"",n=t+"_"+e.to+"@"+this.domain;e.group&&(n=t+"_"+e.to+"@conference."+this.domain),e.resource&&(n=n+"/"+e.resource),e.toJid=n,e.id=e.id||this.getUniqueId(),_msgHash[e.id]=new _message(e),_msgHash[e.id].send(this)}else"string"==typeof e&&_msgHash[e]&&_msgHash[e].send(this)},connection.prototype.addRoster=function(e){var t=_getJid(e,this),n=e.name||"",o=e.groups||"",i=$iq({type:"set"});if(i.c("query",{xmlns:"jabber:iq:roster"}),i.c("item",{jid:t,name:n}),o)for(var r=0;r<o.length;r++)i.c("group").t(o[r]).up();var s=e.success||_utils.emptyfn,a=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(i.tree(),s,a)},connection.prototype.removeRoster=function(e){var t=_getJid(e,this),n=$iq({type:"set"}).c("query",{xmlns:"jabber:iq:roster"}).c("item",{jid:t,subscription:"remove"}),o=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(n,o,i)},connection.prototype.getRoster=function(e){var t=$iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"}),e=e||{},n=e.success||this.onRoster,o=function(e){var t=[],o=e.getElementsByTagName("query");if(o&&o.length>0){var i=o[0];t=_parseFriend(i)}n(t,e)},i=e.error||this.onError,r=function(e){i({type:_code.WEBIM_CONNCTION_GETROSTER_ERROR,data:e})};this.isOpened()?this.context.stropheConn.sendIQ(t.tree(),o,r):i({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.subscribe=function(e){var t=_getJid(e,this),n=$pres({to:t,type:"subscribe"});e.message&&n.c("status").t(e.message).up(),e.nick&&n.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(e.nick),this.sendCommand(n.tree())},connection.prototype.subscribed=function(e){var t=_getJid(e,this),n=$pres({to:t,type:"subscribed"});e.message&&n.c("status").t(e.message).up(),this.sendCommand(n.tree())},connection.prototype.unsubscribe=function(e){var t=_getJid(e,this),n=$pres({to:t,type:"unsubscribe"});e.message&&n.c("status").t(e.message),this.sendCommand(n.tree())},connection.prototype.unsubscribed=function(e){var t=_getJid(e,this),n=$pres({to:t,type:"unsubscribed"});e.message&&n.c("status").t(e.message).up(),this.sendCommand(n.tree())},connection.prototype.createRoom=function(e){var t,n=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn;return t=$iq({to:e.roomName,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this.context.stropheConn.sendIQ(t.tree(),n,o)},connection.prototype.joinPublicGroup=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,n=t+"/"+this.context.userId,o=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,r=function(e){i({type:_code.WEBIM_CONNCTION_JOINROOM_ERROR,data:e})},s=$pres({from:this.context.jid,to:n}).c("x",{xmlns:Strophe.NS.MUC});this.context.stropheConn.sendIQ(s.tree(),o,r)},connection.prototype.listRooms=function(e){var t=$iq({to:e.server||"conference."+this.domain,from:this.context.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),n=e.success||_utils.emptyfn,o=e.error||this.onError,i=function(e){var t=[];t=_parseRoom(e);try{n(t)}catch(e){o({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:e})}},r=e.error||_utils.emptyfn,s=function(e){r({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:e})};this.context.stropheConn.sendIQ(t.tree(),i,s)},connection.prototype.queryRoomMember=function(e){var t=(this.domain,[]),n=$iq({to:this.context.appKey+"_"+e.roomId+"@conference."+this.domain,type:"get"}).c("query",{xmlns:Strophe.NS.MUC+"#admin"}).c("item",{affiliation:"member"}),o=e.success||_utils.emptyfn,i=function(e){var n=e.getElementsByTagName("item");if(n)for(var i=0;i<n.length;i++){var r=n[i],s={jid:r.getAttribute("jid"),affiliation:"member"};t.push(s)}o(t)},r=e.error||_utils.emptyfn,s=function(e){r({type:_code.WEBIM_CONNCTION_GETROOMMEMBER_ERROR,data:e})};this.context.stropheConn.sendIQ(n.tree(),i,s)},connection.prototype.queryRoomInfo=function(e){var t=this.domain,n=$iq({to:this.context.appKey+"_"+e.roomId+"@conference."+t,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_INFO}),o=e.success||_utils.emptyfn,i=[],r=function(e){var n="",r=e.getElementsByTagName("feature");switch(r&&(n=r[1].getAttribute("var")+"|"+r[3].getAttribute("var")+"|"+r[4].getAttribute("var")),n){case"muc_public|muc_membersonly|muc_notallowinvites":n="PUBLIC_JOIN_APPROVAL";break;case"muc_public|muc_open|muc_notallowinvites":n="PUBLIC_JOIN_OPEN";break;case"muc_hidden|muc_membersonly|muc_allowinvites":n="PRIVATE_MEMBER_INVITE";break;case"muc_hidden|muc_membersonly|muc_notallowinvites":n="PRIVATE_OWNER_INVITE"}var s=e.getElementsByTagName("field"),a={};if(s){for(var c=0;c<s.length;c++){var u=s[c],l=u.getAttribute("var"),d=l.split("_")[1];switch(l){case"muc#roominfo_occupants":case"muc#roominfo_maxusers":case"muc#roominfo_affiliations":case"muc#roominfo_description":a[d]=u.textContent||u.text||"";break;case"muc#roominfo_owner":var h={jid:(u.textContent||u.text)+"@"+t,affiliation:"owner"};i.push(h),a[d]=u.textContent||u.text}}a.name=e.getElementsByTagName("identity")[0].getAttribute("name")}log(n,i,a),o(n,i,a)},s=e.error||_utils.emptyfn,a=function(e){s({type:_code.WEBIM_CONNCTION_GETROOMINFO_ERROR,data:e})};this.context.stropheConn.sendIQ(n.tree(),r,a)},connection.prototype.queryRoomOccupants=function(e){var t=e.success||_utils.emptyfn,n=function(e){var n=[];n=_parseRoomOccupants(e),t(n)},o=e.error||_utils.emptyfn,i=function(e){o({type:_code.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR,data:e})},r={xmlns:Strophe.NS.DISCO_ITEMS},s=$iq({from:this.context.jid,to:this.context.appKey+"_"+e.roomId+"@conference."+this.domain,type:"get"}).c("query",r);this.context.stropheConn.sendIQ(s.tree(),n,i)},connection.prototype.setUserSig=function(e){var t=$pres({xmlns:"jabber:client"});e=e||"",t.c("status").t(e),this.sendCommand(t.tree())},connection.prototype.setPresence=function(e,t){var n=$pres({xmlns:"jabber:client"});e&&(t?(n.c("show").t(e),n.up().c("status").t(t)):n.c("show").t(e)),this.sendCommand(n.tree())},connection.prototype.getPresence=function(){var e=$pres({xmlns:"jabber:client"});this.sendCommand(e.tree())},connection.prototype.ping=function(e){var e=e||{},t=_getJid(e,this),n=$iq({from:this.context.jid||"",to:t,type:"get"}).c("ping",{xmlns:"urn:xmpp:ping"}),o=e.success||_utils.emptyfn,i=e.error||this.onError,r=function(e){i({type:_code.WEBIM_CONNCTION_PING_ERROR,data:e})};this.isOpened()?this.context.stropheConn.sendIQ(n.tree(),o,r):i({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.isOpened=function(){return this.context.status==_code.STATUS_OPENED},connection.prototype.isOpening=function(){var e=this.context.status;return e==_code.STATUS_DOLOGIN_USERGRID||e==_code.STATUS_DOLOGIN_IM},connection.prototype.isClosing=function(){return this.context.status==_code.STATUS_CLOSING},connection.prototype.isClosed=function(){return this.context.status==_code.STATUS_CLOSED},connection.prototype.clear=function(){var e=this.context.appKey;this.errorType!=WebIM.statusCode.WEBIM_CONNCTION_DISCONNECTED&&(this.context={status:_code.STATUS_INIT,appKey:e}),this.intervalId&&clearInterval(this.intervalId),this.errorType!=WebIM.statusCode.WEBIM_CONNCTION_CLIENT_LOGOUT&&this.errorType!=-1||Demo.api.init()},connection.prototype.getChatRooms=function(e){if(!_utils.isCanSetRequestHeader)return void t.onError({type:_code.WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR});var t=this,n=e.accessToken||this.context.accessToken;if(n){var o=e.apiUrl,i=this.context.appName,r=this.context.orgName;if(!i||!r)return void t.onError({type:_code.WEBIM_CONNCTION_AUTH_ERROR});var s=function(t,n){"function"==typeof e.success&&e.success(t)},a=function(e,n,o){e.error&&e.error_description&&t.onError({type:_code.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,msg:e.error_description,data:e,xhr:n})},c={pagenum:parseInt(e.pagenum)||1,pagesize:parseInt(e.pagesize)||20},u={url:o+"/"+r+"/"+i+"/chatrooms",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+n},data:c,success:s||_utils.emptyfn,error:a||_utils.emptyfn};_utils.ajax(u)}else t.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR})},connection.prototype.joinChatRoom=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,n=t+"/"+this.context.userId,o=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,r=function(e){i({type:_code.WEBIM_CONNCTION_JOINCHATROOM_ERROR,data:e})},s=$pres({from:this.context.jid,to:n}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"member",role:"participant"}).up().up().c("roomtype",{xmlns:"hyphenate:x:roomtype",type:"chatroom"
});this.context.stropheConn.sendIQ(s.tree(),o,r)},connection.prototype.quitChatRoom=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,n=t+"/"+this.context.userId,o=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,r=function(e){i({type:_code.WEBIM_CONNCTION_QUITCHATROOM_ERROR,data:e})},s=$pres({from:this.context.jid,to:n,type:"unavailable"}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"none",role:"none"}).up().up().c("roomtype",{xmlns:"hyphenate:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(s.tree(),o,r)},connection.prototype._onReceiveInviteFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation",msg:info.user+" invites you to join into group:"+info.group_id,agree:function(){WebIM.doQuery('{"type":"acceptInvitationFromGroup","id":"'+info.group_id+'","user":"'+info.user+'"}',function(e){},function(e,t){Demo.api.NotifyError("acceptInvitationFromGroup error:"+t)})},reject:function(){WebIM.doQuery('{"type":"declineInvitationFromGroup","id":"'+info.group_id+'","user":"'+info.user+'"}',function(e){},function(e,t){Demo.api.NotifyError("declineInvitationFromGroup error:"+t)})}};this.onConfirmPop(options)},connection.prototype._onReceiveInviteAcceptionFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation response",msg:info.user+" agreed to join into group:"+info.group_id,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveInviteDeclineFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation response",msg:info.user+" rejected to join into group:"+info.group_id,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onAutoAcceptInvitationFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation",msg:"You had joined into the group:"+info.group_name+" automatically.Inviter:"+info.user,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onLeaveGroup=function(info){info=eval("("+info+")");var options={title:"Group notification",msg:"You have been out of the group:"+info.group_id+".Reason:"+info.msg,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveJoinGroupApplication=function(info){info=eval("("+info+")");var options={title:"Group join application",msg:info.user+" applys to join into group:"+info.group_id,agree:function(){WebIM.doQuery('{"type":"acceptJoinGroupApplication","id":"'+info.group_id+'","user":"'+info.user+'"}',function(e){},function(e,t){Demo.api.NotifyError("acceptJoinGroupApplication error:"+t)})},reject:function(){WebIM.doQuery('{"type":"declineJoinGroupApplication","id":"'+info.group_id+'","user":"'+info.user+'"}',function(e){},function(e,t){Demo.api.NotifyError("declineJoinGroupApplication error:"+t)})}};this.onConfirmPop(options)},connection.prototype._onReceiveAcceptionFromGroup=function(info){info=eval("("+info+")");var options={title:"Group notification",msg:"You had joined into the group:"+info.group_name+".",agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveRejectionFromGroup=function(){info=eval("("+info+")");var options={title:"Group notification",msg:"You have been rejected to join into the group:"+info.group_name+".",agree:function(){}};this.onConfirmPop(options)},connection.prototype._onUpdateMyGroupList=function(e){this.onUpdateMyGroupList(e)},connection.prototype._onUpdateMyRoster=function(e){this.onUpdateMyRoster(e)},connection.prototype.reconnect=function(){var e=this;setTimeout(function(){_login(e.context.restTokenData,e)},1e3*(0==this.autoReconnectNumTotal?0:this.autoReconnectInterval)),this.autoReconnectNumTotal++},connection.prototype.closed=function(){Demo.api.init()},connection.prototype.getBlacklist=function(e){e=e||{};var t=$iq({type:"get"}),n=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,i=this;t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),this.context.stropheConn.sendIQ(t.tree(),function(e){i.onBlacklistUpdate(_parsePrivacy(e)),n()},function(){i.onBlacklistUpdate([]),o()})},connection.prototype.addToBlackList=function(e){for(var t=$iq({type:"set"}),n=e.list||{},o=e.type||"jid",i=e.success||_utils.emptyfn,r=e.error||_utils.emptyfn,s=t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),a=Object.keys(n),c=a.length,u=2,l=0;l<c;l++){var d=n[a[l]],o=d.type||"jid",h=d.jid;s=s.c("item",{action:"deny",order:u++,type:o,value:h}).c("message"),l!==c-1&&(s=s.up().up())}this.context.stropheConn.sendIQ(s.tree(),i,r)},connection.prototype.removeFromBlackList=function(e){for(var t=$iq({type:"set"}),n=e.list||{},o=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,r=t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),s=Object.keys(n),a=s.length,c=0;c<a;c++){var u=n[s[c]],l=u.type||"jid",d=u.jid,h=u.order;r=r.c("item",{action:"deny",order:h,type:l,value:d}).c("message"),c!==a-1&&(r=r.up().up())}this.context.stropheConn.sendIQ(r.tree(),o,i)},connection.prototype._getGroupJid=function(e){var t=this.context.appKey||"";return t+"_"+e+"@conference."+this.domain},connection.prototype.addToGroupBlackList=function(e){var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,o=_getJid(e,this),i="admin",r=this._getGroupJid(e.roomId),s=$iq({type:"set",to:r});s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}).c("item",{affiliation:"outcast",jid:o}),this.context.stropheConn.sendIQ(s.tree(),t,n)},connection.prototype.getGroupBlacklist=function(e){var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,o="admin",i=this._getGroupJid(e.roomId),r=$iq({type:"get",to:i});r.c("query",{xmlns:"http://jabber.org/protocol/muc#"+o}).c("item",{affiliation:"outcast"}),this.context.stropheConn.sendIQ(r.tree(),function(e){log("getGroupBlackList"),t(_parseGroupBlacklist(e))},function(){n()})},connection.prototype.removeGroupMemberFromBlacklist=function(e){var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,o=_getJid(e,this),i="admin",r=this._getGroupJid(e.roomId),s=$iq({type:"set",to:r});s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}).c("item",{affiliation:"member",jid:o}),this.context.stropheConn.sendIQ(s.tree(),function(e){t()},function(){n()})},connection.prototype.changeGroupSubject=function(e){var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,o="owner",i=this._getGroupJid(e.roomId),r=$iq({type:"set",to:i});r.c("query",{xmlns:"http://jabber.org/protocol/muc#"+o}).c("x",{type:"submit",xmlns:"jabber:x:data"}).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up().c("field",{var:"muc#roomconfig_roomname"}).c("value").t(e.subject).up().up().c("field",{var:"muc#roomconfig_roomdesc"}).c("value").t(e.description),this.context.stropheConn.sendIQ(r.tree(),function(e){t()},function(){n()})},connection.prototype.destroyGroup=function(e){var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,o="owner",i=this._getGroupJid(e.roomId),r=$iq({type:"set",to:i});r.c("query",{xmlns:"http://jabber.org/protocol/muc#"+o}).c("destroy"),this.context.stropheConn.sendIQ(r.tree(),function(e){t()},function(){n()})},connection.prototype.leaveGroupBySelf=function(e){var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,o=_getJid(e,this),i="admin",r=this._getGroupJid(e.roomId),s=$iq({type:"set",to:r});s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}).c("item",{affiliation:"none",jid:o}),this.context.stropheConn.sendIQ(s.tree(),function(e){t(e)},function(e){n(e)})},connection.prototype.leaveGroup=function(e){for(var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,o=e.list||[],i="admin",r=this._getGroupJid(e.roomId),s=$iq({type:"set",to:r}),a=s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}),c=Object.keys(o),u=c.length,l=0;l<u;l++){var d=o[c[l]],h=_getJidByName(d,this);a=a.c("item",{affiliation:"none",jid:h}).up().c("item",{role:"none",jid:h}).up()}this.context.stropheConn.sendIQ(s.tree(),function(e){t(e)},function(e){n(e)})},connection.prototype.addGroupMembers=function(e){for(var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,o=e.list||[],i="admin",r=this._getGroupJid(e.roomId),s=$iq({type:"set",to:r}),a=s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}),c=Object.keys(o),u=c.length,l=0;l<u;l++){var d=o[c[l]],h=_getJidByName(d,this);a=a.c("item",{affiliation:"member",jid:h}).up()}this.context.stropheConn.sendIQ(s.tree(),function(e){t(e)},function(e){n(e)})},connection.prototype.acceptInviteFromGroup=function(e){e.success=function(){},this.addGroupMembers(e)},connection.prototype.rejectInviteFromGroup=function(e){},connection.prototype.createGroup=function(e){var t=+new Date,n=this._getGroupJid(t),o=n+"/"+this.context.userId,i=$pres({to:o}).c("x",{xmlns:"http://jabber.org/protocol/muc"}).up().c("create",{xmlns:"http://jabber.org/protocol/muc"}).up();this.sendCommand(i.tree());var r=this;setTimeout(function(){var o=$iq({type:"get",to:n}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});r.context.stropheConn.sendIQ(o.tree(),function(o){if("setAttribute"in o){var i=o.getElementsByTagName("x")[0];i.setAttribute("type","submit")}else Strophe.forEachChild(o,"x",function(e){e.setAttribute("type","submit")});Strophe.info("step 5 ----------"),Strophe.forEachChild(i,"field",function(t){var n=t.getAttribute("var"),o=t.getElementsByTagName("value")[0];switch(Strophe.info(n),n){case"muc#roomconfig_roomname":_setText(o,e.subject||"");break;case"muc#roomconfig_roomdesc":_setText(o,e.description||"");break;case"muc#roomconfig_publicroom":_setText(o,+e.optionsPublic);break;case"muc#roomconfig_membersonly":_setText(o,+e.optionsMembersOnly);break;case"muc#roomconfig_moderatedroom":_setText(o,+e.optionsModerate);break;case"muc#roomconfig_persistentroom":_setText(o,1);break;case"muc#roomconfig_allowinvites":_setText(o,+e.optionsAllowInvites);break;case"muc#roomconfig_allowvisitornickchange":_setText(o,0);break;case"muc#roomconfig_allowvisitorstatus":_setText(o,0);break;case"allow_private_messages":_setText(o,0);break;case"allow_private_messages_from_visitors":_setText(o,"nobody")}});var s=$iq({to:n,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).cnode(i);r.context.stropheConn.sendIQ(s.tree(),function(n){r.addGroupMembers({list:e.members,roomId:t})},function(e){})},function(e){})},1e3)},window.WebIM="undefined"!=typeof WebIM?WebIM:{},WebIM.connection=connection,WebIM.utils=_utils,WebIM.statusCode=_code,WebIM.message=_msg.message,WebIM.doQuery=function(e,t,n){"undefined"!=typeof window.cefQuery&&window.cefQuery({request:e,persistent:!1,onSuccess:t,onFailure:n})},module.exports=WebIM},function(e,t,n){var o,i,r,s,a,c,a,u,a,l,a,d,a,h;!function(p){if(function(i,r){!(o=function(){return r()}.call(t,n,t,e))}(this,function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t={encode:function(t){var n,o,i,r,s,a,c,u="",l=0;do n=t.charCodeAt(l++),o=t.charCodeAt(l++),i=t.charCodeAt(l++),r=n>>2,s=(3&n)<<4|o>>4,a=(15&o)<<2|i>>6,c=63&i,isNaN(o)?(s=(3&n)<<4,a=c=64):isNaN(i)&&(c=64),u=u+e.charAt(r)+e.charAt(s)+e.charAt(a)+e.charAt(c);while(l<t.length);return u},decode:function(t){var n,o,i,r,s,a,c,u="",l=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=e.indexOf(t.charAt(l++)),s=e.indexOf(t.charAt(l++)),a=e.indexOf(t.charAt(l++)),c=e.indexOf(t.charAt(l++)),n=r<<2|s>>4,o=(15&s)<<4|a>>2,i=(3&a)<<6|c,u+=String.fromCharCode(n),64!=a&&(u+=String.fromCharCode(o)),64!=c&&(u+=String.fromCharCode(i));while(l<t.length);return u}};return t}),function(o,r){!(i=function(){return r()}.call(t,n,t,e))}(this,function(){function e(e,o){e[o>>5]|=128<<24-o%32,e[(o+64>>9<<4)+15]=o;var s,a,c,u,l,d,h,p,_=new Array(80),m=1732584193,f=-271733879,g=-1732584194,y=271733878,v=-1009589776;for(s=0;s<e.length;s+=16){for(u=m,l=f,d=g,h=y,p=v,a=0;a<80;a++)a<16?_[a]=e[s+a]:_[a]=r(_[a-3]^_[a-8]^_[a-14]^_[a-16],1),c=i(i(r(m,5),t(a,f,g,y)),i(i(v,_[a]),n(a))),v=y,y=g,g=r(f,30),f=m,m=c;m=i(m,u),f=i(f,l),g=i(g,d),y=i(y,h),v=i(v,p)}return[m,f,g,y,v]}function t(e,t,n,o){return e<20?t&n|~t&o:e<40?t^n^o:e<60?t&n|t&o|n&o:t^n^o}function n(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function o(t,n){var o=s(t);o.length>16&&(o=e(o,8*t.length));for(var i=new Array(16),r=new Array(16),a=0;a<16;a++)i[a]=909522486^o[a],r[a]=1549556828^o[a];var c=e(i.concat(s(n)),512+8*n.length);return e(r.concat(c),672)}function i(e,t){var n=(65535&e)+(65535&t),o=(e>>16)+(t>>16)+(n>>16);return o<<16|65535&n}function r(e,t){return e<<t|e>>>32-t}function s(e){for(var t=[],n=255,o=0;o<8*e.length;o+=8)t[o>>5]|=(e.charCodeAt(o/8)&n)<<24-o%32;return t}function a(e){for(var t="",n=255,o=0;o<32*e.length;o+=8)t+=String.fromCharCode(e[o>>5]>>>24-o%32&n);return t}function c(e){for(var t,n,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="",r=0;r<4*e.length;r+=3)for(t=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255,n=0;n<4;n++)i+=8*r+6*n>32*e.length?"=":o.charAt(t>>6*(3-n)&63);return i}return{b64_hmac_sha1:function(e,t){return c(o(e,t))},b64_sha1:function(t){return c(e(s(t),8*t.length))},binb2str:a,core_hmac_sha1:o,str_hmac_sha1:function(e,t){return a(o(e,t))},str_sha1:function(t){return a(e(s(t),8*t.length))}}}),function(o,i){!(r=function(){return i()}.call(t,n,t,e))}(this,function(e){var t=function(e,t){var n=(65535&e)+(65535&t),o=(e>>16)+(t>>16)+(n>>16);return o<<16|65535&n},n=function(e,t){return e<<t|e>>>32-t},o=function(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},i=function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t},r=function(e){for(var t="0123456789abcdef",n="",o=0;o<4*e.length;o++)n+=t.charAt(e[o>>2]>>o%4*8+4&15)+t.charAt(e[o>>2]>>o%4*8&15);return n},s=function(e,o,i,r,s,a){return t(n(t(t(o,e),t(r,a)),s),i)},a=function(e,t,n,o,i,r,a){return s(t&n|~t&o,e,t,i,r,a)},c=function(e,t,n,o,i,r,a){return s(t&o|n&~o,e,t,i,r,a)},u=function(e,t,n,o,i,r,a){return s(t^n^o,e,t,i,r,a)},l=function(e,t,n,o,i,r,a){return s(n^(t|~o),e,t,i,r,a)},d=function(e,n){e[n>>5]|=128<<n%32,e[(n+64>>>9<<4)+14]=n;for(var o,i,r,s,d=1732584193,h=-271733879,p=-1732584194,_=271733878,m=0;m<e.length;m+=16)o=d,i=h,r=p,s=_,d=a(d,h,p,_,e[m+0],7,-680876936),_=a(_,d,h,p,e[m+1],12,-389564586),p=a(p,_,d,h,e[m+2],17,606105819),h=a(h,p,_,d,e[m+3],22,-1044525330),d=a(d,h,p,_,e[m+4],7,-176418897),_=a(_,d,h,p,e[m+5],12,1200080426),p=a(p,_,d,h,e[m+6],17,-1473231341),h=a(h,p,_,d,e[m+7],22,-45705983),d=a(d,h,p,_,e[m+8],7,1770035416),_=a(_,d,h,p,e[m+9],12,-1958414417),p=a(p,_,d,h,e[m+10],17,-42063),h=a(h,p,_,d,e[m+11],22,-1990404162),d=a(d,h,p,_,e[m+12],7,1804603682),_=a(_,d,h,p,e[m+13],12,-40341101),p=a(p,_,d,h,e[m+14],17,-1502002290),h=a(h,p,_,d,e[m+15],22,1236535329),d=c(d,h,p,_,e[m+1],5,-165796510),_=c(_,d,h,p,e[m+6],9,-1069501632),p=c(p,_,d,h,e[m+11],14,643717713),h=c(h,p,_,d,e[m+0],20,-373897302),d=c(d,h,p,_,e[m+5],5,-701558691),_=c(_,d,h,p,e[m+10],9,38016083),p=c(p,_,d,h,e[m+15],14,-660478335),h=c(h,p,_,d,e[m+4],20,-405537848),d=c(d,h,p,_,e[m+9],5,568446438),_=c(_,d,h,p,e[m+14],9,-1019803690),p=c(p,_,d,h,e[m+3],14,-187363961),h=c(h,p,_,d,e[m+8],20,1163531501),d=c(d,h,p,_,e[m+13],5,-1444681467),_=c(_,d,h,p,e[m+2],9,-51403784),p=c(p,_,d,h,e[m+7],14,1735328473),h=c(h,p,_,d,e[m+12],20,-1926607734),d=u(d,h,p,_,e[m+5],4,-378558),_=u(_,d,h,p,e[m+8],11,-2022574463),p=u(p,_,d,h,e[m+11],16,1839030562),h=u(h,p,_,d,e[m+14],23,-35309556),d=u(d,h,p,_,e[m+1],4,-1530992060),_=u(_,d,h,p,e[m+4],11,1272893353),p=u(p,_,d,h,e[m+7],16,-155497632),h=u(h,p,_,d,e[m+10],23,-1094730640),d=u(d,h,p,_,e[m+13],4,681279174),_=u(_,d,h,p,e[m+0],11,-358537222),p=u(p,_,d,h,e[m+3],16,-722521979),h=u(h,p,_,d,e[m+6],23,76029189),d=u(d,h,p,_,e[m+9],4,-640364487),_=u(_,d,h,p,e[m+12],11,-421815835),p=u(p,_,d,h,e[m+15],16,530742520),h=u(h,p,_,d,e[m+2],23,-995338651),d=l(d,h,p,_,e[m+0],6,-198630844),_=l(_,d,h,p,e[m+7],10,1126891415),p=l(p,_,d,h,e[m+14],15,-1416354905),h=l(h,p,_,d,e[m+5],21,-57434055),d=l(d,h,p,_,e[m+12],6,1700485571),_=l(_,d,h,p,e[m+3],10,-1894986606),p=l(p,_,d,h,e[m+10],15,-1051523),h=l(h,p,_,d,e[m+1],21,-2054922799),d=l(d,h,p,_,e[m+8],6,1873313359),_=l(_,d,h,p,e[m+15],10,-30611744),p=l(p,_,d,h,e[m+6],15,-1560198380),h=l(h,p,_,d,e[m+13],21,1309151649),d=l(d,h,p,_,e[m+4],6,-145523070),_=l(_,d,h,p,e[m+11],10,-1120210379),p=l(p,_,d,h,e[m+2],15,718787259),h=l(h,p,_,d,e[m+9],21,-343485551),d=t(d,o),h=t(h,i),p=t(p,r),_=t(_,s);return[d,h,p,_]},h={hexdigest:function(e){return r(d(o(e),8*e.length))},hash:function(e){return i(d(o(e),8*e.length))}};return h}),function(o,i){!(s=function(){return i()}.call(t,n,t,e))}(this,function(){var e={utf16to8:function(e){var t,n,o="",i=e.length;for(t=0;t<i;t++)n=e.charCodeAt(t),n>=0&&n<=127?o+=e.charAt(t):n>2047?(o+=String.fromCharCode(224|n>>12&15),o+=String.fromCharCode(128|n>>6&63),o+=String.fromCharCode(128|n>>0&63)):(o+=String.fromCharCode(192|n>>6&31),o+=String.fromCharCode(128|n>>0&63));return o},addCookies:function(e){var t,n,o,i,r,s,a;for(t in e||{})r="",s="",a="",n=e[t],o="object"==typeof n,i=escape(unescape(o?n.value:n)),o&&(r=n.expires?";expires="+n.expires:"",s=n.domain?";domain="+n.domain:"",a=n.path?";path="+n.path:""),document.cookie=t+"="+i+r+s+a}};return e}),function(e,n){a=[],!(c=function(){return n()}.apply(t,a))}(this,function(){Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice,o=Array.prototype.concat,i=n.call(arguments,1);return function(){return t.apply(e?e:this,o.call(i,n.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,n=Number(arguments[1])||0;for(n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);n<t;n++)if(n in this&&this[n]===e)return n;return-1})}),function(e,n){a=[i,o,r,s,c],!(u=function(){return n.apply(this,arguments)}.apply(t,a))}(this,function(e,t,n,o){function i(e,t){return new c.Builder(e,t)}function r(e){return new c.Builder("message",e)}function s(e){return new c.Builder("iq",e)}function a(e){return new c.Builder("presence",e)}var c;return c={VERSION:"1.2.8",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<c.XHTML.tags.length;t++)if(e==c.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if("undefined"!=typeof c.XHTML.attributes[e]&&c.XHTML.attributes[e].length>0)for(var n=0;n<c.XHTML.attributes[e].length;n++)if(t==c.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<c.XHTML.css.length;t++)if(e==c.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){c.NS[e]=t},forEachChild:function(e,t,n){var o,i;for(o=0;o<e.childNodes.length;o++)i=e.childNodes[o],i.nodeType!=c.ElementType.NORMAL||t&&!this.isTagEqual(i,t)||n(i)},isTagEqual:function(e,t){return e.tagName==t},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom(),e.appendChild(e.createElement("strophe"))):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return c._xmlGenerator||(c._xmlGenerator=c._makeGenerator()),c._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(t){e=null}return e},xmlElement:function(e){if(!e)return null;var t,n,o,i=c.xmlGenerator().createElement(e);for(t=1;t<arguments.length;t++){var r=arguments[t];if(r)if("string"==typeof r||"number"==typeof r)i.appendChild(c.xmlTextNode(r));else if("object"==typeof r&&"function"==typeof r.sort)for(n=0;n<r.length;n++){var s=r[n];"object"==typeof s&&"function"==typeof s.sort&&void 0!==s[1]&&null!==s[1]&&i.setAttribute(s[0],s[1])}else if("object"==typeof r)for(o in r)r.hasOwnProperty(o)&&void 0!==r[o]&&null!==r[o]&&i.setAttribute(o,r[o])}return i},xmlescape:function(e){return e=e.replace(/\&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/"/g,"&quot;")},xmlunescape:function(e){return e=e.replace(/\&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&apos;/g,"'"),e=e.replace(/&quot;/g,'"')},xmlTextNode:function(e){return c.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;if(window.DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType==c.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType==c.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return c.xmlescape(t)},copyElement:function(e){var t,n;if(e.nodeType==c.ElementType.NORMAL){for(n=c.xmlElement(e.tagName),t=0;t<e.attributes.length;t++)n.setAttribute(e.attributes[t].nodeName,e.attributes[t].value);for(t=0;t<e.childNodes.length;t++)n.appendChild(c.copyElement(e.childNodes[t]))}else e.nodeType==c.ElementType.TEXT&&(n=c.xmlGenerator().createTextNode(e.nodeValue));return n},createHtml:function(e){var t,n,o,i,r,s,a,u,l,d,h;if(e.nodeType==c.ElementType.NORMAL)if(i=e.nodeName.toLowerCase(),c.XHTML.validTag(i))try{for(n=c.xmlElement(i),t=0;t<c.XHTML.attributes[i].length;t++)if(r=c.XHTML.attributes[i][t],s=e.getAttribute(r),"undefined"!=typeof s&&null!==s&&""!==s&&s!==!1&&0!==s)if("style"==r&&"object"==typeof s&&"undefined"!=typeof s.cssText&&(s=s.cssText),"style"==r){for(a=[],u=s.split(";"),o=0;o<u.length;o++)l=u[o].split(":"),d=l[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),c.XHTML.validCSS(d)&&(h=l[1].replace(/^\s*/,"").replace(/\s*$/,""),a.push(d+": "+h));a.length>0&&(s=a.join("; "),n.setAttribute(r,s))}else n.setAttribute(r,s);for(t=0;t<e.childNodes.length;t++)n.appendChild(c.createHtml(e.childNodes[t]))}catch(e){n=c.xmlTextNode("")}else for(n=c.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(c.createHtml(e.childNodes[t]));else if(e.nodeType==c.ElementType.FRAGMENT)for(n=c.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(c.createHtml(e.childNodes[t]));else e.nodeType==c.ElementType.TEXT&&(n=c.xmlTextNode(e.nodeValue));return n},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=c.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},log:function(e,t){},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){var t;if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var n,o,i=e.nodeName;for(e.getAttribute("_realname")&&(i=e.getAttribute("_realname")),t="<"+i,n=0;n<e.attributes.length;n++)"_realname"!=e.attributes[n].nodeName&&(t+=" "+e.attributes[n].nodeName+"='"+c.xmlescape(e.attributes[n].value)+"'");if(e.childNodes.length>0){for(t+=">",n=0;n<e.childNodes.length;n++)switch(o=e.childNodes[n],o.nodeType){case c.ElementType.NORMAL:t+=c.serialize(o);break;case c.ElementType.TEXT:t+=c.xmlescape(o.nodeValue);break;case c.ElementType.CDATA:t+="<![CDATA["+o.nodeValue+"]]>"}t+="</"+i+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){c._connectionPlugins[e]=t}},c.Builder=function(e,t){"presence"!=e&&"message"!=e&&"iq"!=e||(t&&!t.xmlns?t.xmlns=c.NS.CLIENT:t||(t={xmlns:c.NS.CLIENT})),this.nodeTree=c.xmlElement(e,t),this.node=this.nodeTree},c.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return c.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(e){for(var t in e)e.hasOwnProperty(t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,n){var o=c.xmlElement(e,t,n);return this.node.appendChild(o),"string"!=typeof n&&"number"!=typeof n&&(this.node=o),this},cnode:function(e){var t,n=c.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}var o=t?n.importNode(e,!0):c.copyElement(e);return this.node.appendChild(o),this.node=o,this},t:function(e){var t=c.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=c.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},c.Handler=function(e,t,n,o,i,r,s){this.handler=e,this.ns=t,this.name=n,this.type=o,this.id=i,this.options=s||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.options.matchBare?this.from=r?c.getBareJidFromJid(r):null:this.from=r,this.user=!0},c.Handler.prototype={isMatch:function(e){var t,n=null;if(n=this.options.matchBare?c.getBareJidFromJid(e.getAttribute("from")):e.getAttribute("from"),t=!1,this.ns){var o=this;c.forEachChild(e,null,function(e){e.getAttribute("xmlns")==o.ns&&(t=!0)}),t=t||e.getAttribute("xmlns")==this.ns}else t=!0;var i=e.getAttribute("type");return!(!t||this.name&&!c.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?this.type.indexOf(i)==-1:i!=this.type)||this.id&&e.getAttribute("id")!=this.id||this.from&&n!=this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(e){throw e.sourceURL?c.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",e,e.message)),c.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message)):c.fatal("error: "+e.message+"\n"+e.stack),e}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},c.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},c.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},c.Connection=function(e,t){this.service=e,this.options=t||{};var n=this.options.protocol||"";0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===n.indexOf("ws")?this._proto=new c.Websocket(this):this._proto=new c.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100),o.addCookies(this.options.cookies);for(var i in c._connectionPlugins)if(c._connectionPlugins.hasOwnProperty(i)){var r=c._connectionPlugins[i],s=function(){};s.prototype=r,this[i]=new s,this[i].init(this)}},c.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},connect:function(e,t,n,o,i,r,s){this.jid=e,this.authzid=c.getBareJidFromJid(this.jid),this.authcid=s||c.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=c.getDomainFromJid(this.jid),this._changeConnectStatus(c.Status.CONNECTING,null),this._proto._connect(o,i,r)},attach:function(e,t,n,o,i,r,s){if(!(this._proto instanceof c.Bosh))throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};this._proto._attach(e,t,n,o,i,r,s)},restore:function(e,t,n,o,i){if(!this._sessionCachingSupported())throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};this._proto._restore(e,t,n,o,i)},_sessionCachingSupported:function(){if(this._proto instanceof c.Bosh){if(!JSON)return!1;try{window.sessionStorage.setItem("_strophe_","_strophe_"),window.sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},nextValidRid:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(e,t,n,o){var i=null,r=this;"function"==typeof e.tree&&(e=e.tree());var s=e.getAttribute("id");s||(s=this.getUniqueId("sendIQ"),e.setAttribute("id",s));var a=e.getAttribute("to"),u=this.jid,l=this.addHandler(function(e){i&&r.deleteTimedHandler(i);var o=!1,s=e.getAttribute("from");if(s!==a&&(a||s!==c.getBareJidFromJid(u)&&s!==c.getDomainFromJid(u)&&s!==u)||(o=!0),!o)throw{name:"StropheError",message:"Got answer to IQ from wrong jid:"+s+"\nExpected jid: "+a
};var l=e.getAttribute("type");if("result"==l)t&&t(e);else{if("error"!=l)throw{name:"StropheError",message:"Got bad IQ type of "+l};n&&n(e)}},null,"iq",["error","result"],s);return o&&(i=this.addTimedHandler(o,function(){return r.deleteHandler(l),n&&n(null),!1})),this.send(e),s},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(e)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(e,t){var n=new c.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,o,i,r,s){var a=new c.Handler(e,t,n,o,i,r,s);return this.addHandlers.push(a),a},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)},disconnect:function(e){if(this._changeConnectStatus(c.Status.DISCONNECTING,e),c.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=a({xmlns:c.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else c.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests()},_changeConnectStatus:function(e,t){for(var n in c._connectionPlugins)if(c._connectionPlugins.hasOwnProperty(n)){var o=this[n];if(o.statusChanged)try{o.statusChanged(e,t)}catch(e){c.error(""+n+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(e,t)}catch(e){c.error("User connection callback caused an exception: "+e)}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),c.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(c.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){c.info("_dataRecv called"),WebIM&&WebIM.config.isDebug&&c.info(JSON.stringify(e));var n=this._proto._reqToData(e);if(null!==n){this.xmlInput!==c.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==c.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(c.serialize(n)));for(var o,i;this.removeHandlers.length>0;)i=this.removeHandlers.pop(),o=this.handlers.indexOf(i),o>=0&&this.handlers.splice(o,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var r,s,a=n.getAttribute("type");if(null!==a&&"terminate"==a){if(this.disconnecting)return;return r=n.getAttribute("condition"),s=n.getElementsByTagName("conflict"),null!==r?("remote-stream-error"==r&&s.length>0&&(r="conflict"),this._changeConnectStatus(c.Status.CONNFAIL,r)):this._changeConnectStatus(c.Status.CONNFAIL,"unknown"),void this._doDisconnect(r)}var u=this;c.forEachChild(n,null,function(e){var t,n;for(n=u.handlers,u.handlers=[],t=0;t<n.length;t++){var o=n[t];try{!o.isMatch(e)||!u.authenticated&&o.user?u.handlers.push(o):o.run(e)&&u.handlers.push(o)}catch(e){c.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}},mechanisms:{},_connect_cb:function(e,t,n){c.info("_connect_cb was called"),this.connected=!0;var o;try{o=this._proto._reqToData(e)}catch(e){if("badformat"!=e)throw e;this._changeConnectStatus(c.Status.CONNFAIL,"bad-format"),this._doDisconnect("bad-format")}if(o){this.xmlInput!==c.Connection.prototype.xmlInput&&(o.nodeName===this._proto.strip&&o.childNodes.length?this.xmlInput(o.childNodes[0]):this.xmlInput(o)),this.rawInput!==c.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(c.serialize(o)));var i=this._proto._connect_cb(o);if(i!==c.Status.CONNFAIL){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var r;r=o.getElementsByTagNameNS?o.getElementsByTagNameNS(c.NS.STREAM,"features").length>0:o.getElementsByTagName("stream:features").length>0||o.getElementsByTagName("features").length>0;var s,a,u=o.getElementsByTagName("mechanism"),l=[],d=!1;if(!r)return void this._proto._no_auth_received(t);if(u.length>0)for(s=0;s<u.length;s++)a=c.getText(u[s]),this.mechanisms[a]&&l.push(this.mechanisms[a]);return this._authentication.legacy_auth=o.getElementsByTagName("auth").length>0,(d=this._authentication.legacy_auth||l.length>0)?void(this.do_authentication!==!1&&this.authenticate(l)):void this._proto._no_auth_received(t)}}},authenticate:function(e){var n;for(n=0;n<e.length-1;++n){for(var o=n,r=n+1;r<e.length;++r)e[r].prototype.priority>e[o].prototype.priority&&(o=r);if(o!=n){var a=e[n];e[n]=e[o],e[o]=a}}var u=!1;for(n=0;n<e.length;++n)if(e[n].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);var l=i("auth",{xmlns:c.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var d=this._sasl_mechanism.onChallenge(this,null);l.t(t.encode(d))}this.send(l.tree()),u=!0;break}u||(null===c.getNodeFromJid(this.jid)?(this._changeConnectStatus(c.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(c.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(s({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(e){var n=t.decode(c.getText(e)),o=this._sasl_mechanism.onChallenge(this,n),r=i("response",{xmlns:c.NS.SASL});return""!==o&&r.t(t.encode(o)),this.send(r.tree()),!0},_auth1_cb:function(e){var t=s({type:"set",id:"_auth_2"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return c.getResourceFromJid(this.jid)||(this.jid=c.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(c.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){if(this._sasl_data["server-signature"]){var n,o=t.decode(c.getText(e)),i=/([a-z]+)=([^,]+)(,|$)/,r=o.match(i);if("v"==r[1]&&(n=r[2]),n!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}c.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var s=[],a=function(e,t){for(;e.length;)this.deleteHandler(e.pop());return this._sasl_auth1_cb.bind(this)(t),!1};return s.push(this._addSysHandler(function(e){a.bind(this)(s,e)}.bind(this),null,"stream:features",null,null)),s.push(this._addSysHandler(function(e){a.bind(this)(s,e)}.bind(this),c.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;var t,n;for(t=0;t<e.childNodes.length;t++)n=e.childNodes[t],"bind"==n.nodeName&&(this.do_bind=!0),"session"==n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(c.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var o=c.getResourceFromJid(this.jid);return o?this.send(s({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).c("resource",{}).t(o).tree()):this.send(s({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){if("error"==e.getAttribute("type")){c.info("SASL binding failed.");var t,n=e.getElementsByTagName("conflict");return n.length>0&&(t="conflict"),this._changeConnectStatus(c.Status.AUTHFAIL,t),!1}var o,i=e.getElementsByTagName("bind");return i.length>0?(o=i[0].getElementsByTagName("jid"),void(o.length>0&&(this.jid=c.getText(o[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(s({type:"set",id:"_session_auth_2"}).c("session",{xmlns:c.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null))))):(c.info("SASL binding failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(e){if("result"==e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null);else if("error"==e.getAttribute("type"))return c.info("Session creation failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1},_auth2_cb:function(e){return"result"==e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null)):"error"==e.getAttribute("type")&&(this._changeConnectStatus(c.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new c.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,o,i){var r=new c.Handler(e,t,n,o,i);return r.user=!1,this.addHandlers.push(r),r},_onDisconnectTimeout:function(){return c.info("_onDisconnectTimeout was called"),this._changeConnectStatus(c.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e,t,n,o;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)t=this.removeTimeds.pop(),e=this.timedHandlers.indexOf(t),e>=0&&this.timedHandlers.splice(e,1);var i=(new Date).getTime();for(o=[],e=0;e<this.timedHandlers.length;e++)t=this.timedHandlers[e],!this.authenticated&&t.user||(n=t.lastCalled+t.period,n-i<=0?t.run()&&o.push(t):o.push(t));this.timedHandlers=o,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100))}},c.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},c.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},c.SASLAnonymous=function(){},c.SASLAnonymous.prototype=new c.SASLMechanism("ANONYMOUS",(!1),10),c.SASLAnonymous.prototype.test=function(e){return null===e.authcid},c.Connection.prototype.mechanisms[c.SASLAnonymous.prototype.name]=c.SASLAnonymous,c.SASLPlain=function(){},c.SASLPlain.prototype=new c.SASLMechanism("PLAIN",(!0),20),c.SASLPlain.prototype.test=function(e){return null!==e.authcid},c.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,o.utf16to8(t)},c.Connection.prototype.mechanisms[c.SASLPlain.prototype.name]=c.SASLPlain,c.SASLSHA1=function(){},c.SASLSHA1.prototype=new c.SASLMechanism("SCRAM-SHA-1",(!0),40),c.SASLSHA1.prototype.test=function(e){return null!==e.authcid},c.SASLSHA1.prototype.onChallenge=function(i,r,s){var a=s||n.hexdigest(1234567890*Math.random()),c="n="+o.utf16to8(i.authcid);return c+=",r=",c+=a,i._sasl_data.cnonce=a,i._sasl_data["client-first-message-bare"]=c,c="n,,"+c,this.onChallenge=function(n,i){for(var r,s,a,c,u,l,d,h,p,_,m,f,g="c=biws,",y=n._sasl_data["client-first-message-bare"]+","+i+",",v=n._sasl_data.cnonce,E=/([a-z]+)=([^,]+)(,|$)/;i.match(E);){var N=i.match(E);switch(i=i.replace(N[0],""),N[1]){case"r":r=N[2];break;case"s":s=N[2];break;case"i":a=N[2]}}if(r.substr(0,v.length)!==v)return n._sasl_data={},n._sasl_failure_cb();for(g+="r="+r,y+=g,s=t.decode(s),s+="\0\0\0",p=o.utf16to8(n.pass),c=l=e.core_hmac_sha1(p,s),d=1;d<a;d++){for(u=e.core_hmac_sha1(p,e.binb2str(l)),h=0;h<5;h++)c[h]^=u[h];l=u}for(c=e.binb2str(c),_=e.core_hmac_sha1(c,"Client Key"),m=e.str_hmac_sha1(c,"Server Key"),f=e.core_hmac_sha1(e.str_sha1(e.binb2str(_)),y),n._sasl_data["server-signature"]=e.b64_hmac_sha1(m,y),h=0;h<5;h++)_[h]^=f[h];return g+=",p="+t.encode(e.binb2str(_))}.bind(this),c},c.Connection.prototype.mechanisms[c.SASLSHA1.prototype.name]=c.SASLSHA1,c.SASLMD5=function(){},c.SASLMD5.prototype=new c.SASLMechanism("DIGEST-MD5",(!1),30),c.SASLMD5.prototype.test=function(e){return null!==e.authcid},c.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},c.SASLMD5.prototype.onChallenge=function(e,t,i){for(var r,s=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,a=i||n.hexdigest(""+1234567890*Math.random()),c="",u=null,l="",d="";t.match(s);)switch(r=t.match(s),t=t.replace(r[0],""),r[2]=r[2].replace(/^"(.+)"$/,"$1"),r[1]){case"realm":c=r[2];break;case"nonce":l=r[2];break;case"qop":d=r[2];break;case"host":u=r[2]}var h=e.servtype+"/"+e.domain;null!==u&&(h=h+"/"+u);var p=o.utf16to8(e.authcid+":"+c+":"+this._connection.pass),_=n.hash(p)+":"+l+":"+a,m="AUTHENTICATE:"+h,f="";return f+="charset=utf-8,",f+="username="+this._quote(o.utf16to8(e.authcid))+",",f+="realm="+this._quote(c)+",",f+="nonce="+this._quote(l)+",",f+="nc=00000001,",f+="cnonce="+this._quote(a)+",",f+="digest-uri="+this._quote(h)+",",f+="response="+n.hexdigest(n.hexdigest(_)+":"+l+":00000001:"+a+":auth:"+n.hexdigest(m))+",",f+="qop=auth",this.onChallenge=function(){return""},f},c.Connection.prototype.mechanisms[c.SASLMD5.prototype.name]=c.SASLMD5,c.SASLOAuthBearer=function(){},c.SASLOAuthBearer.prototype=new c.SASLMechanism("OAUTHBEARER",(!0),50),c.SASLOAuthBearer.prototype.test=function(e){return null!==e.authcid},c.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,a=";return t+=e.authzid,t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",o.utf16to8(t)},c.Connection.prototype.mechanisms[c.SASLOAuthBearer.prototype.name]=c.SASLOAuthBearer,c.SASLExternal=function(){},c.SASLExternal.prototype=new c.SASLMechanism("EXTERNAL",(!0),60),c.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},c.Connection.prototype.mechanisms[c.SASLExternal.prototype.name]=c.SASLExternal,{Strophe:c,$build:i,$msg:r,$iq:s,$pres:a,SHA1:e,Base64:t,MD5:n}}),function(e,n){a=[u],!(l=function(e){return n(e.Strophe,e.$build)}.apply(t,a))}(this,function(e,t){return e.Request=function(t,n,o,i){this.id=++e._requestId,this.xmlData=t,this.data=e.serialize(t),this.origFunc=n,this.func=n,this.rid=o,this.date=NaN,this.sends=i||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var e=new Date;return(e-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var e=new Date;return(e-this.dead)/1e3},this.xhr=this._newXHR()},e.Request.prototype={getResponse:function(){var t=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(t=this.xhr.responseXML.documentElement,"parsererror"==t.tagName)throw e.error("invalid response received"),e.error("responseText: "+this.xhr.responseText),e.error("responseXML: "+e.serialize(this.xhr.responseXML)),"parsererror"}else if(this.xhr.responseText)throw e.error("invalid response received"),e.error("responseText: "+this.xhr.responseText),"badformat";return t},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},e.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this._requests=[]},e.Bosh.prototype={strip:null,_buildBody:function(){var n=t("body",{rid:this.rid++,xmlns:e.NS.HTTPBIND});return null!==this.sid&&n.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),n},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(t,n,o){this.wait=t||this.wait,this.hold=n||this.hold,this.errors=0;var i=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":e.NS.BOSH});o&&i.attrs({route:o});var r=this._conn._connect_cb;this._requests.push(new e.Request(i.tree(),this._onRequestStateChange.bind(this,r.bind(this._conn)),i.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(t,n,o,i,r,s,a){this._conn.jid=t,this.sid=n,this.rid=o,this._conn.connect_callback=i,this._conn.domain=e.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=r||this.wait,this.hold=s||this.hold,this.window=a||this.window,this._conn._changeConnectStatus(e.Status.ATTACHED,null)},_restore:function(t,n,o,i,r){var s=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!("undefined"!=typeof s&&null!==s&&s.rid&&s.sid&&s.jid)||"undefined"!=typeof t&&null!==t&&e.getBareJidFromJid(s.jid)!=e.getBareJidFromJid(t))throw{name:"StropheSessionError",message:"_restore: no restoreable session."};this._conn.restored=!0,this._attach(s.jid,s.sid,s.rid,n,o,i,r)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(t){var n,o,i=t.getAttribute("type");if(null!==i&&"terminate"==i)return n=t.getAttribute("condition"),e.error("BOSH-Connection failed: "+n),o=t.getElementsByTagName("conflict"),null!==n?("remote-stream-error"==n&&o.length>0&&(n="conflict"),this._conn._changeConnectStatus(e.Status.CONNFAIL,n)):this._conn._changeConnectStatus(e.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),e.Status.CONNFAIL;this.sid||(this.sid=t.getAttribute("sid"));var r=t.getAttribute("requests");r&&(this.window=parseInt(r,10));var s=t.getAttribute("hold");s&&(this.hold=parseInt(s,10));var a=t.getAttribute("wait");a&&(this.wait=parseInt(a,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(t){this.errors++,e.warn("request errored, status: "+t+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(t){t=t?t.bind(this._conn):this._conn._connect_cb.bind(this._conn);var n=this._buildBody();this._requests.push(new e.Request(n.tree(),this._onRequestStateChange.bind(this,t.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var e;this._requests.length>0;)e=this._requests.pop(),e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}},_onIdle:function(){var t=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===t.length&&!this._conn.disconnecting&&(e.info("no requests during idle cycle, sending blank request"),t.push(null)),!this._conn.paused){if(this._requests.length<2&&t.length>0){for(var n=this._buildBody(),o=0;o<t.length;o++)null!==t[o]&&("restart"===t[o]?n.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":e.NS.BOSH}):n.cnode(t[o]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new e.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var i=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(e.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),i>Math.floor(e.TIMEOUT*this.wait)&&(e.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(e.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_onRequestStateChange:function(t,n){if(e.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)return void(n.abort=!1);var o;if(4==n.xhr.readyState){o=0;try{o=n.xhr.status}catch(e){}if("undefined"==typeof o&&(o=0),this.disconnecting&&o>=400)return void this._hitError(o);var i=this._requests[0]==n,r=this._requests[1]==n;(o>0&&o<500||n.sends>5)&&(this._removeRequest(n),e.debug("request id "+n.id+" should now be removed")),200==o?((r||i&&this._requests.length>0&&this._requests[0].age()>Math.floor(e.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),e.debug("request id "+n.id+"."+n.sends+" got 200"),t(n),this.errors=0):(e.error("request id "+n.id+"."+n.sends+" error "+o+" happened"),(0===o||o>=400&&o<600||o>=12e3)&&(this._hitError(o),o>=400&&o<500&&(this._conn._changeConnectStatus(e.Status.DISCONNECTING,null),this._conn._doDisconnect()))),o>0&&o<500||n.sends>5||this._throttledRequestHandler()}},_processRequest:function(t){var n=this,o=this._requests[t],i=-1;try{4==o.xhr.readyState&&(i=o.xhr.status)}catch(n){e.error("caught an error in _requests["+t+"], reqStatus: "+i)}if("undefined"==typeof i&&(i=-1),o.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();var r=o.age(),s=!isNaN(r)&&r>Math.floor(e.TIMEOUT*this.wait),a=null!==o.dead&&o.timeDead()>Math.floor(e.SECONDARY_TIMEOUT*this.wait),c=4==o.xhr.readyState&&(i<1||i>=500);if((s||a||c)&&(a&&e.error("Request "+this._requests[t].id+" timed out (secondary), restarting"),o.abort=!0,o.xhr.abort(),o.xhr.onreadystatechange=function(){},this._requests[t]=new e.Request(o.xmlData,o.origFunc,o.rid,o.sends),o=this._requests[t]),0===o.xhr.readyState){e.debug("request id "+o.id+"."+o.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";o.xhr.open("POST",this._conn.service,!this._conn.options.sync),o.xhr.setRequestHeader&&o.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(o.xhr.withCredentials=!0)}catch(t){return e.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(e.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var l=function(){if(o.date=new Date,n._conn.options.customHeaders){var e=n._conn.options.customHeaders;for(var t in e)e.hasOwnProperty(t)&&o.xhr.setRequestHeader(t,e[t])}o.xhr.send(o.data)};if(o.sends>1){var d=1e3*Math.min(Math.floor(e.TIMEOUT*this.wait),Math.pow(o.sends,3));setTimeout(function(){l()},d)}else l();o.sends++,this._conn.xmlOutput!==e.Connection.prototype.xmlOutput&&(o.xmlData.nodeName===this.strip&&o.xmlData.childNodes.length?this._conn.xmlOutput(o.xmlData.childNodes[0]):this._conn.xmlOutput(o.xmlData)),this._conn.rawOutput!==e.Connection.prototype.rawOutput&&this._conn.rawOutput(o.data)}else e.debug("_processRequest: "+(0===t?"first":"second")+" request has readyState of "+o.xhr.readyState)},_removeRequest:function(t){e.debug("removing request");var n;for(n=this._requests.length-1;n>=0;n--)t==this._requests[n]&&this._requests.splice(n,1);t.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(e){if("parsererror"!=e)throw e;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(t){e.info("_sendTerminate was called");var n=this._buildBody().attrs({type:"terminate"});t&&n.cnode(t.tree());var o=new e.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"));this._requests.push(o),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?e.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):e.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},e}),function(e,n){a=[u],!(d=function(e){return n(e.Strophe,e.$build)}.apply(t,a))}(this,function(e,t){return e.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";n+="ws"===e.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",n+="://"+window.location.host,n+=0!==t.indexOf("/")?window.location.pathname+t:t,e.service=n}},e.Websocket.prototype={_buildStream:function(){return t("open",{xmlns:e.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(t,n){var o;if(o=t.getElementsByTagNameNS?t.getElementsByTagNameNS(e.NS.STREAM,"error"):t.getElementsByTagName("stream:error"),0===o.length)return!1;for(var i=o[0],r="",s="",a="urn:ietf:params:xml:ns:xmpp-streams",c=0;c<i.childNodes.length;c++){var u=i.childNodes[c];if(u.getAttribute("xmlns")!==a)break;"text"===u.nodeName?s=u.textContent:r=u.nodeName}var l="WebSocket stream error: ";return l+=r?r:"unknown",s&&(l+=" - "+r),e.error(l),this._conn._changeConnectStatus(n,r),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(t){var n=this._check_streamerror(t,e.Status.CONNFAIL);if(n)return e.Status.CONNFAIL},_handleStreamStart:function(t){var n=!1,o=t.getAttribute("xmlns");"string"!=typeof o?n="Missing xmlns in <open />":o!==e.NS.FRAMING&&(n="Wrong xmlns in <open />: "+o);var i=t.getAttribute("version");return"string"!=typeof i?n="Missing version in <open />":"1.0"!==i&&(n="Wrong version in <open />: "+i),!n||(this._conn._changeConnectStatus(e.Status.CONNFAIL,n),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(t){if(0===t.data.indexOf("<open ")||0===t.data.indexOf("<?xml")){var n=t.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===n)return;var o=(new DOMParser).parseFromString(n,"text/xml").documentElement;this._conn.xmlInput(o),this._conn.rawInput(t.data),this._handleStreamStart(o)&&this._connect_cb(o)}else if(0===t.data.indexOf("<close ")){this._conn.rawInput(t.data),this._conn.xmlInput(t);var i=t.getAttribute("see-other-uri");i?(this._conn._changeConnectStatus(e.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=i,this._connect()):(this._conn._changeConnectStatus(e.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var r=this._streamWrap(t.data),s=(new DOMParser).parseFromString(r,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(s,null,t.data)}},_disconnect:function(n){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){n&&this._conn.send(n);var o=t("close",{xmlns:e.NS.FRAMING});this._conn.xmlOutput(o);var i=e.serialize(o);this._conn.rawOutput(i);try{this.socket.send(i)}catch(t){e.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){e.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(e){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(e.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e.info("Websocket closed")},_no_auth_received:function(t){e.error("Server did not send any auth methods"),this._conn._changeConnectStatus(e.Status.CONNFAIL,"Server did not send any auth methods"),t&&(t=t.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(t){e.error("Websocket error "+t),this._conn._changeConnectStatus(e.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var t=this._conn._data;if(t.length>0&&!this._conn.paused){for(var n=0;n<t.length;n++)if(null!==t[n]){var o,i;o="restart"===t[n]?this._buildStream().tree():t[n],i=e.serialize(o),this._conn.xmlOutput(o),this._conn.rawOutput(i),this.socket.send(i)}this._conn._data=[]}},_onMessage:function(t){WebIM&&WebIM.config.isDebug&&e.info(WebIM.utils.ts()+"recv:",t.data);var n,o,i='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(t.data===i)return this._conn.rawInput(i),this._conn.xmlInput(t),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===t.data.search("<open ")){if(n=(new DOMParser).parseFromString(t.data,"text/xml").documentElement,!this._handleStreamStart(n))return}else o=this._streamWrap(t.data),n=(new DOMParser).parseFromString(o,"text/xml").documentElement;return this._check_streamerror(n,e.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===n.firstChild.nodeName&&"unavailable"===n.firstChild.getAttribute("type")?(this._conn.xmlInput(n),void this._conn.rawInput(e.serialize(n))):void this._conn._dataRecv(n,t.data)},_onOpen:function(){e.info("Websocket open");var t=this._buildStream();this._conn.xmlOutput(t.tree());var n=e.serialize(t);this._conn.rawOutput(n),this.socket.send(n)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},e}),function(e){a=[u,l,d],!(h=function(e){return e}.apply(t,a))}(this),p){var _=p;"function"==typeof requirejs?requirejs(["strophe"],function(e){_(e.Strophe,e.$build,e.$msg,e.$iq,e.$pres)}):!function(){var e=[h];(function(e){_(e.Strophe,e.$build,e.$msg,e.$iq,e.$pres)}).apply(null,e)}()}}(function(e,t,n,o,i){window.Strophe=e,window.$build=t,window.$msg=n,window.$iq=o,window.$pres=i})},function(e,t){!function(){var e=0,n=100,o=200,i=300,r=400;t.code={WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_OPEN_ERROR:e++,WEBIM_CONNCTION_AUTH_ERROR:e++,WEBIM_CONNCTION_OPEN_USERGRID_ERROR:e++,WEBIM_CONNCTION_ATTACH_ERROR:e++,WEBIM_CONNCTION_ATTACH_USERGRID_ERROR:e++,WEBIM_CONNCTION_REOPEN_ERROR:e++,WEBIM_CONNCTION_SERVER_CLOSE_ERROR:e++,WEBIM_CONNCTION_SERVER_ERROR:e++,WEBIM_CONNCTION_IQ_ERROR:e++,WEBIM_CONNCTION_PING_ERROR:e++,
WEBIM_CONNCTION_NOTIFYVERSION_ERROR:e++,WEBIM_CONNCTION_GETROSTER_ERROR:e++,WEBIM_CONNCTION_CROSSDOMAIN_ERROR:e++,WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES:e++,WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR:e++,WEBIM_CONNCTION_DISCONNECTED:e++,WEBIM_CONNCTION_AJAX_ERROR:e++,WEBIM_CONNCTION_JOINROOM_ERROR:e++,WEBIM_CONNCTION_GETROOM_ERROR:e++,WEBIM_CONNCTION_GETROOMINFO_ERROR:e++,WEBIM_CONNCTION_GETROOMMEMBER_ERROR:e++,WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR:e++,WEBIM_CONNCTION_LOAD_CHATROOM_ERROR:e++,WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR:e++,WEBIM_CONNCTION_JOINCHATROOM_ERROR:e++,WEBIM_CONNCTION_QUITCHATROOM_ERROR:e++,WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_CALLBACK_INNER_ERROR:e++,WEBIM_CONNCTION_CLIENT_OFFLINE:e++,WEBIM_CONNCTION_CLIENT_LOGOUT:e++,WEBIM_UPLOADFILE_BROWSER_ERROR:n++,WEBIM_UPLOADFILE_ERROR:n++,WEBIM_UPLOADFILE_NO_LOGIN:n++,WEBIM_UPLOADFILE_NO_FILE:n++,WEBIM_DOWNLOADFILE_ERROR:o++,WEBIM_DOWNLOADFILE_NO_LOGIN:o++,WEBIM_DOWNLOADFILE_BROWSER_ERROR:o++,WEBIM_MESSAGE_REC_TEXT:i++,WEBIM_MESSAGE_REC_TEXT_ERROR:i++,WEBIM_MESSAGE_REC_EMOTION:i++,WEBIM_MESSAGE_REC_PHOTO:i++,WEBIM_MESSAGE_REC_AUDIO:i++,WEBIM_MESSAGE_REC_AUDIO_FILE:i++,WEBIM_MESSAGE_REC_VEDIO:i++,WEBIM_MESSAGE_REC_VEDIO_FILE:i++,WEBIM_MESSAGE_REC_FILE:i++,WEBIM_MESSAGE_SED_TEXT:i++,WEBIM_MESSAGE_SED_EMOTION:i++,WEBIM_MESSAGE_SED_PHOTO:i++,WEBIM_MESSAGE_SED_AUDIO:i++,WEBIM_MESSAGE_SED_AUDIO_FILE:i++,WEBIM_MESSAGE_SED_VEDIO:i++,WEBIM_MESSAGE_SED_VEDIO_FILE:i++,WEBIM_MESSAGE_SED_FILE:i++,STATUS_INIT:r++,STATUS_DOLOGIN_USERGRID:r++,STATUS_DOLOGIN_IM:r++,STATUS_OPENED:r++,STATUS_CLOSING:r++,STATUS_CLOSED:r++,STATUS_ERROR:r++}}()},function(e,t,n){!function(){var e=function(){},o=n(3).code,i=10485760,r=function(){try{return new window.XMLHttpRequest}catch(e){return!1}},s=function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}},a=function(t){t=t||!0;var n=r()||s();if("withCredentials"in n)return n;if(!t)return n;if("undefined"==typeof window.XDomainRequest)return n;var o=new XDomainRequest;return o.readyState=0,o.status=100,o.onreadystatechange=e,o.onload=function(){o.readyState=4,o.status=200;var e=new ActiveXObject("Microsoft.XMLDOM");e.async="false",e.loadXML(o.responseText),o.responseXML=e,o.response=o.responseText,o.onreadystatechange()},o.ontimeout=o.onerror=function(){o.readyState=4,o.status=500,o.onreadystatechange()},o},c=function(){if("ActiveXObject"in window)try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){return 0}else if(navigator.plugins&&navigator.plugins.length>0)return navigator.plugins["Shockwave Flash"];return 0}(),u=a(),l="undefined"!=typeof FormData,d="undefined"!=typeof Blob,h=u.setRequestHeader||!1,p=u.overrideMimeType||!1,_=h&&l,m=_||c,f=h&&(d||p);Object.keys||(Object.keys=function(){"use strict";var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=n.length;return function(i){if("object"!=typeof i&&("function"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var r,s,a=[];for(r in i)e.call(i,r)&&a.push(r);if(t)for(s=0;s<o;s++)e.call(i,n[s])&&a.push(n[s]);return a}}());var g={hasFormData:l,hasBlob:d,emptyfn:e,isCanSetRequestHeader:h,hasOverrideMimeType:p,isCanUploadFileAsync:_,isCanUploadFile:m,isCanDownLoadFile:f,isSupportWss:function(){var e=[/MQQBrowser[\/]5([.]\d+)?\sTBS/];if(!window.WebSocket)return!1;for(var t=window.navigator.userAgent,n=0,o=e.length;n<o;n++)if(e[n].test(t))return!1;return!0}(),getIEVersion:function(){var e,t=navigator.userAgent,n={4:8,5:9,6:10,7:11};return e=t.match(/MSIE (\d+)/i),e&&e[1]?+e[1]:(e=t.match(/Trident\/(\d+)/i),e&&e[1]?n[e[1]]||null:null)}(),stringify:function(e){if("undefined"!=typeof JSON&&JSON.stringify)return JSON.stringify(e);var t="",n=[],o=function(e){var i=!1;"[object Array]"===Object.prototype.toString.call(e)?(n.push("]","["),i=!0):"[object Object]"===Object.prototype.toString.call(e)&&n.push("}","{");for(var r in e)"[object Null]"===Object.prototype.toString.call(e[r])?e[r]="null":"[object Undefined]"===Object.prototype.toString.call(e[r])&&(e[r]="undefined"),t+=e[r]&&"object"==typeof e[r]?","+(i?"":'"'+r+'":'+(i?'"':""))+o(e[r]):',"'+(i?"":r+'":"')+e[r]+'"';return""!=t&&(t=t.slice(1)),n.pop()+t+n.pop()};return o(e)},registerUser:function(t){var n=t.orgName||"",i=t.appName||"",r=t.appKey||"",s=t.success||e,a=t.error||e;if(!n&&!i&&r){var c=r.split("#");2===c.length&&(n=c[0],i=c[1])}if(!n&&!i)return void a({type:o.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR});var u=t.https||u,l=t.apiUrl,d=l+"/"+n+"/"+i+"/users",h={username:t.username,password:t.password,nickname:t.nickname||""},p=g.stringify(h),t={url:d,dataType:"json",data:p,success:s,error:a};return g.ajax(t)},login:function(t){var t=t||{},n=t.success||e,i=t.error||e,r=t.appKey||"",s=r.split("#");if(2!==s.length)return i({type:o.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var a=s[0],c=s[1],u=u||t.https,l=t.user||"",d=t.pwd||"",h=t.apiUrl,p={grant_type:"password",username:l,password:d,timestamp:+new Date},_=g.stringify(p),t={url:h+"/"+a+"/"+c+"/token",dataType:"json",data:_,success:n,error:i};return g.ajax(t)},getFileUrl:function(e){var t={url:"",filename:"",filetype:"",data:""},n="string"==typeof e?document.getElementById(e):e;if(!g.isCanUploadFileAsync||!n)return t;try{if(window.URL.createObjectURL){var o=n.files;if(o.length>0){var i=o.item(0);t.data=i,t.url=window.URL.createObjectURL(i),t.filename=i.name||""}}else{var i=document.getElementById(e).value;t.url=i;var r=i.lastIndexOf("/"),s=i.lastIndexOf("\\"),a=Math.max(r,s);a<0?t.filename=i:t.filename=i.substring(a+1)}var c=t.filename.lastIndexOf(".");return c!=-1&&(t.filetype=t.filename.substring(c+1).toLowerCase()),t}catch(e){throw e}},getFileSize:function(e){var t=document.getElementById(e),n=0;if(t)if(t.files)t.files.length>0&&(n=t.files[0].size);else if(t.select&&"ActiveXObject"in window){t.select();var o=new ActiveXObject("Scripting.FileSystemObject"),t=o.GetFile(t.value);n=t.Size}return n},hasFlash:c,trim:function(e){return e="string"==typeof e?e:"",e.trim?e.trim():e.replace(/^\s|\s$/g,"")},parseEmoji:function(e){if("undefined"==typeof WebIM.Emoji||"undefined"==typeof WebIM.Emoji.map)return e;var t=WebIM.Emoji;for(var n in t.map)if(t.map.hasOwnProperty(n))for(;e.indexOf(n)>-1;)e=e.replace(n,'<img class="emoji" src="'+t.path+t.map[n]+'" />');return e},parseLink:function(e){var t=/(https?\:\/\/|www\.)([a-zA-Z0-9-]+(\.[a-zA-Z0-9]+)+)(\:[0-9]{2,4})?\/?((\.[:_0-9a-zA-Z-]+)|[:_0-9a-zA-Z-]*\/?)*\??[:_#@*&%0-9a-zA-Z-\/=]*/gm;return e=e.replace(t,function(e){var t=/^https?/gm.test(e);return"<a href='"+(t?e:"//"+e)+"' target='_blank'>"+e+"</a>"})},parseJSON:function(e){if(window.JSON&&window.JSON.parse)return window.JSON.parse(e+"");var t,n=null,o=g.trim(e+"");return o&&!g.trim(o.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,function(e,o,i,r){return t&&o&&(n=0),0===n?e:(t=i||o,n+=!r-!i,"")}))?Function("return "+o)():Function("Invalid JSON: "+e)()},parseUploadResponse:function(e){return e.indexOf("callback")>-1?e.slice(9,-1):e},parseDownloadResponse:function(e){return e&&e.type&&"application/json"===e.type||0>Object.prototype.toString.call(e).indexOf("Blob")?this.url+"?token=":window.URL.createObjectURL(e)},uploadFile:function(t){var t=t||{};t.onFileUploadProgress=t.onFileUploadProgress||e,t.onFileUploadComplete=t.onFileUploadComplete||e,t.onFileUploadError=t.onFileUploadError||e,t.onFileUploadCanceled=t.onFileUploadCanceled||e;var n=t.accessToken||this.context.accessToken;if(!n)return void t.onFileUploadError({type:o.WEBIM_UPLOADFILE_NO_LOGIN,id:t.id});var r,s,a,c=t.appKey||this.context.appKey||"";if(c&&(a=c.split("#"),r=a[0],s=a[1]),!r&&!s)return void t.onFileUploadError({type:o.WEBIM_UPLOADFILE_ERROR,id:t.id});var u=t.apiUrl,l=u+"/"+r+"/"+s+"/chatfiles";if(!g.isCanUploadFileAsync)return void(g.hasFlash&&"function"==typeof t.flashUpload?t.flashUpload&&t.flashUpload(l,t):t.onFileUploadError({type:o.WEBIM_UPLOADFILE_BROWSER_ERROR,id:t.id}));var d=t.file.data?t.file.data.size:void 0;if(d>i)return void t.onFileUploadError({type:o.WEBIM_UPLOADFILE_ERROR,id:t.id});if(d<=0)return void t.onFileUploadError({type:o.WEBIM_UPLOADFILE_ERROR,id:t.id});var h=g.xmlrequest(),p=function(e){t.onFileUploadError({type:o.WEBIM_UPLOADFILE_ERROR,id:t.id,xhr:h})};h.upload&&h.upload.addEventListener("progress",t.onFileUploadProgress,!1),h.addEventListener?(h.addEventListener("abort",t.onFileUploadCanceled,!1),h.addEventListener("load",function(e){try{var n=g.parseJSON(h.responseText);try{t.onFileUploadComplete(n)}catch(e){t.onFileUploadError({type:o.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}}catch(e){t.onFileUploadError({type:o.WEBIM_UPLOADFILE_ERROR,data:h.responseText,id:t.id,xhr:h})}},!1),h.addEventListener("error",p,!1)):h.onreadystatechange&&(h.onreadystatechange=function(){if(4===h.readyState)if(200===ajax.status)try{var e=g.parseJSON(h.responseText);t.onFileUploadComplete(e)}catch(e){t.onFileUploadError({type:o.WEBIM_UPLOADFILE_ERROR,data:h.responseText,id:t.id,xhr:h})}else t.onFileUploadError({type:o.WEBIM_UPLOADFILE_ERROR,data:h.responseText,id:t.id,xhr:h});else h.abort(),t.onFileUploadCanceled()}),h.open("POST",l),h.setRequestHeader("restrict-access","true"),h.setRequestHeader("Accept","*/*"),h.setRequestHeader("Authorization","Bearer "+n);var _=new FormData;_.append("file",t.file.data),h.send(_)},download:function(t){t.onFileDownloadComplete=t.onFileDownloadComplete||e,t.onFileDownloadError=t.onFileDownloadError||e;var n=t.accessToken||this.context.accessToken;if(!n)return void t.onFileDownloadError({type:o.WEBIM_DOWNLOADFILE_NO_LOGIN,id:t.id});var i=function(e){t.onFileDownloadError({type:o.WEBIM_DOWNLOADFILE_ERROR,id:t.id,xhr:r})};if(!g.isCanDownLoadFile)return void t.onFileDownloadComplete();var r=g.xmlrequest();"addEventListener"in r?(r.addEventListener("load",function(e){t.onFileDownloadComplete(r.response,r)},!1),r.addEventListener("error",i,!1)):"onreadystatechange"in r&&(r.onreadystatechange=function(){4===r.readyState?200===ajax.status?t.onFileDownloadComplete(r.response,r):t.onFileDownloadError({type:o.WEBIM_DOWNLOADFILE_ERROR,id:t.id,xhr:r}):(r.abort(),t.onFileDownloadError({type:o.WEBIM_DOWNLOADFILE_ERROR,id:t.id,xhr:r}))});var s=t.method||"GET",a=t.responseType||"blob",c=t.mimeType||"text/plain; charset=x-user-defined";r.open(s,t.url),"undefined"!=typeof Blob?r.responseType=a:r.overrideMimeType(c);var u={"X-Requested-With":"XMLHttpRequest",Accept:"application/octet-stream","share-secret":t.secret,Authorization:"Bearer "+n},l=t.headers||{};for(var d in l)u[d]=l[d];for(var d in u)u[d]&&r.setRequestHeader(d,u[d]);r.send(null)},parseTextMessage:function(e,t){if("string"==typeof e){if("[object Object]"!==Object.prototype.toString.call(t))return{isemoji:!1,body:[{type:"txt",data:e}]};var n=e,o=[],i=/\[[^[\]]{2,3}\]/gm,r=n.match(i);if(!r||r.length<1)return{isemoji:!1,body:[{type:"txt",data:e}]};for(var s=!1,a=0;a<r.length;a++){var c=n.substring(0,n.indexOf(r[a])),u=WebIM.Emoji.map[r[a]];if(c&&o.push({type:"txt",data:c}),u){var l=WebIM.Emoji.map?WebIM.Emoji.path+u:null;l?(s=!0,o.push({type:"emoji",data:l})):o.push({type:"txt",data:r[a]});var d=n.indexOf(r[a])+r[a].length;n=n.substring(d)}else o.push({type:"txt",data:r[a]})}return n&&o.push({type:"txt",data:n}),s?{isemoji:s,body:o}:{isemoji:!1,body:[{type:"txt",data:e}]}}},xmlrequest:a,ajax:function(t){var n=t.dataType||"text",i=t.success||e,r=t.error||e,s=g.xmlrequest();s.onreadystatechange=function(){if(4===s.readyState){var e=s.status||0;if(200===e){try{switch(n){case"text":return void i(s.responseText);case"json":var t=g.parseJSON(s.responseText);return void i(t,s);case"xml":return void(s.responseXML&&s.responseXML.documentElement?i(s.responseXML.documentElement,s):r({type:o.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText}))}i(s.response||s.responseText,s)}catch(e){r({type:o.WEBIM_CONNCTION_AJAX_ERROR,data:e})}return}return void r({type:o.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText})}0===s.readyState&&r({type:o.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText})},t.responseType&&s.responseType&&(s.responseType=t.responseType),t.mimeType&&g.hasOverrideMimeType&&s.overrideMimeType(t.mimeType);var a=t.type||"POST",c=t.data||null,u="";if("get"===a.toLowerCase()&&c){for(var l in c)c.hasOwnProperty(l)&&(u+=l+"="+c[l]+"&");u=u?u.slice(0,-1):u,t.url+=(t.url.indexOf("?")>0?"&":"?")+(u?u+"&":u)+"_v="+(new Date).getTime(),c=null,u=null}if(s.open(a,t.url),g.isCanSetRequestHeader){var d=t.headers||{};for(var h in d)d.hasOwnProperty(h)&&s.setRequestHeader(h,d[h])}return s.send(c),s},ts:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),o=e.getSeconds(),i=e.getMilliseconds();return(t<10?"0"+t:t)+":"+(n<10?"0"+n:n)+":"+(o<10?"0"+o:o)+":"+i+" "},getObjectKey:function(e,t){for(var n in e)if(e[n]==t)return n;return""}};t.utils=g}()},function(e,t,n){!function(){"use strict";var e=n(4).utils,o=function(e,t){return!this instanceof o?new o(e):(this._msg={},"function"==typeof o[e]&&(o[e].prototype.setGroup=this.setGroup,this._msg=new o[e](t)),this._msg)};o.prototype.setGroup=function(e){this.body.group=e},o.txt=function(e){this.id=e,this.type="txt",this.body={}},o.txt.prototype.set=function(e){this.value=e.msg,this.body={id:this.id,to:e.to,msg:this.value,type:this.type,roomType:e.roomType,ext:e.ext||{},success:e.success,fail:e.fail},!e.roomType&&delete this.body.roomType},o.cmd=function(e){this.id=e,this.type="cmd",this.body={}},o.cmd.prototype.set=function(e){this.value="",this.body={to:e.to,action:e.action,msg:this.value,type:this.type,roomType:e.roomType,ext:e.ext||{}},!e.roomType&&delete this.body.roomType},o.location=function(e){this.id=e,this.type="loc",this.body={}},o.location.prototype.set=function(e){this.body={to:e.to,type:this.type,roomType:e.roomType,addr:e.addr,lat:e.lat,lng:e.lng,ext:e.ext||{}}},o.img=function(e){this.id=e,this.type="img",this.body={}},o.img.prototype.set=function(t){t.file=t.file||e.getFileUrl(t.fileInputId),this.value=t.file,this.body={id:this.id,file:this.value,apiUrl:t.apiUrl,to:t.to,type:this.type,ext:t.ext||{},roomType:t.roomType,onFileUploadError:t.onFileUploadError,onFileUploadComplete:t.onFileUploadComplete,success:t.success,fail:t.fail,flashUpload:t.flashUpload,width:t.width,height:t.height,body:t.body},!t.roomType&&delete this.body.roomType},o.audio=function(e){this.id=e,this.type="audio",this.body={}},o.audio.prototype.set=function(t){t.file=t.file||e.getFileUrl(t.fileInputId),this.value=t.file,this.filename=t.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:t.apiUrl,to:t.to,type:this.type,ext:t.ext||{},length:t.length||0,roomType:t.roomType,file_length:t.file_length,onFileUploadError:t.onFileUploadError,onFileUploadComplete:t.onFileUploadComplete,success:t.success,fail:t.fail,flashUpload:t.flashUpload,body:t.body},!t.roomType&&delete this.body.roomType},o.file=function(e){this.id=e,this.type="file",this.body={}},o.file.prototype.set=function(t){t.file=t.file||e.getFileUrl(t.fileInputId),this.value=t.file,this.filename=t.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:t.apiUrl,to:t.to,type:this.type,ext:t.ext||{},roomType:t.roomType,onFileUploadError:t.onFileUploadError,onFileUploadComplete:t.onFileUploadComplete,success:t.success,fail:t.fail,flashUpload:t.flashUpload,body:t.body},!t.roomType&&delete this.body.roomType},o.video=function(e){},o.video.prototype.set=function(e){};var i=function(e){return!this instanceof i?new i(e,conn):void(this.msg=e)};i.prototype.send=function(t){var n=this,o=function(n){n.ext=n.ext||{},n.ext.weichat=n.ext.weichat||{},n.ext.weichat.originType=n.ext.weichat.originType||"webim";var o={from:t.context.userId||"",to:n.to,bodies:[n.body],ext:n.ext||{}},i=e.stringify(o),r=$msg({type:n.group||"chat",to:n.toJid,id:n.id,xmlns:"jabber:client"}).c("body").t(i);n.roomType&&r.up().c("roomtype",{xmlns:"hyphenate:x:roomtype",type:"chatroom"}),setTimeout(function(){"undefined"!=typeof _msgHash&&_msgHash[n.id]&&_msgHash[n.id].msg.fail instanceof Function&&_msgHash[n.id].msg.fail(n.id)},6e4),t.sendCommand(r.tree(),n.id)};if(n.msg.file){if(n.msg.body&&n.msg.body.url)return void o(n.msg);var i=n.msg.onFileUploadComplete,r=function(e){if(e.entities[0]["file-metadata"]){var t=e.entities[0]["file-metadata"]["content-length"];n.msg.file_length=t,n.msg.filetype=e.entities[0]["file-metadata"]["content-type"],t>204800&&(n.msg.thumbnail=!0)}n.msg.body={type:n.msg.type||"file",url:e.uri+"/"+e.entities[0].uuid,secret:e.entities[0]["share-secret"],filename:n.msg.file.filename||n.msg.filename,size:{width:n.msg.width||0,height:n.msg.height||0},length:n.msg.length||0,file_length:n.msg.file_length||0,filetype:n.msg.filetype},o(n.msg),i instanceof Function&&i(e,n.msg.id)};n.msg.onFileUploadComplete=r,e.uploadFile.call(t,n.msg)}else n.msg.body={type:"chat"===n.msg.type?"txt":n.msg.type,msg:n.msg.msg},"cmd"===n.msg.type?n.msg.body.action=n.msg.action:"loc"===n.msg.type&&(n.msg.body.addr=n.msg.addr,n.msg.body.lat=n.msg.lat,n.msg.body.lng=n.msg.lng),o(n.msg)},t._msg=i,t.message=o}()},function(e,t){!function(){function e(e){this.array=void 0===e?[]:new Array(e)}e.prototype={length:function(){return this.array.length},at:function(e){return this.array[e]},set:function(e,t){this.array[e]=t},push:function(e){return this.array.push(e)},slice:function(e,t){return this.array=this.array.slice(e,t)},concat:function(e){this.array=this.array.concat(e)},remove:function(e,t){t=void 0===t?1:t,this.array.splice(e,t)},join:function(e){return this.array.join(e)},clear:function(){this.array.length=0}};var n=function(){this._array_h=new e};n.prototype={_index:0,push:function(e){this._array_h.push(e)},pop:function(){var e=null;return this._array_h.length()&&(e=this._array_h.at(this._index),2*++this._index>=this._array_h.length()&&(this._array_h.slice(this._index),this._index=0)),e},head:function(){var e=null,t=this._array_h.length();return t&&(e=this._array_h.at(t-1)),e},tail:function(){var e=null,t=this._array_h.length();return t&&(e=this._array_h.at(this._index)),e},length:function(){return this._array_h.length()-this._index},empty:function(){return 0===this._array_h.length()},clear:function(){this._array_h.clear()}},t.Queue=n}()}])});
//# sourceMappingURL=websdk.browser.min.js.map
